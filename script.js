!function e(t,n,i){function s(a,l){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!l&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var r=n[a]={exports:{}};t[a][0].call(r.exports,function(e){var n=t[a][1][e];return s(n?n:e)},r,r.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}({1:[function(e,t){"use strict";function n(){var e=new chrome.cast.SessionRequest(v),t=new chrome.cast.ApiConfig(e,a,o);chrome.cast.initialize(t,i,s)}function i(){console.log("Google Cast init success")}function s(){console.log("Google Cast init error")}function o(e){e===chrome.cast.ReceiverAvailability.AVAILABLE?(console.log("Receiver available"),w.forEach(function(e){e(1)})):(console.log("No receivers available"),w.forEach(function(e){e(0)}))}function a(e){console.log("Session found"),$=e,y.forEach(function(e){e()}),0!==$.media.length&&c("onRequestSessionSuccess",$.media[0])}function l(e){console.log("onMediaError"+JSON.stringify(e))}function c(e,t){console.log("onMediaDiscovered"),m=t,h(),"onRequestSessionSuccess"!==e&&b.forEach(function(e){e()})}function r(e){console.log("onLaunchError called: "+JSON.stringify(e))}function u(e){console.log("session request success"),$=e,y.forEach(function(e){e()}),x&&f(x.url,x.data)}function d(){console.log("Session stop success")}function p(){console.log("Session stop error")}function f(e,t){var n=new chrome.cast.media.MediaInfo(e);n.contentType="video/mp4",n.metadata=t;var i=new chrome.cast.media.LoadRequest(n);$.loadMedia(i,c.bind(this,"loadMedia"),l)}function h(){k.forEach(function(e){m&&e(m.getEstimatedTime())}),S=setTimeout(function(){h()},100)}var v,g=!1,$=null,m=null,b=[],y=[],w=[],k=[],x=null;window.__onGCastApiAvailable=function(e,t){e?(g=!0,console.log("Google Cast loaded"),v&&n()):console.log(t)};var S;t.exports={init:function(e){v=e,g&&n()},start:function(){chrome.cast.requestSession(u,r)},stop:function(){$&&(clearTimeout(S),$.stop(d,p),$=null)},session:function(e){y.push(e)},receiver:function(e){w.push(e)},running:function(){return null!==$},load:function(e,t){$?f(e,t):(x={url:e,data:t},console.log("Loading media after session is available if needed"))},mediaLoaded:function(e){b.push(e)},play:function(){m&&m.play(new chrome.cast.media.PlayRequest,null,null)},pause:function(){m&&m.pause(new chrome.cast.media.PauseRequest,null,null)},seek:function(e){if(m){var t=new chrome.cast.media.SeekRequest;t.currentTime=e,m.seek(t,null,null)}},mute:function(e){if(m){var t=new chrome.cast.media.VolumeRequest(new chrome.cast.Volume(null,e));m.setVolume(t,null,null)}},volume:function(e){if(m){var t=new chrome.cast.media.VolumeRequest(new chrome.cast.Volume(e,null));m.setVolume(t,null,null)}},timeUpdate:function(e){k.push(e)},receiverName:function(){return $.receiver.friendlyName}}},{}],2:[function(e,t){"use strict";function n(e){var t;return $(s+":not(.dragging)").each(function(n,i){Math.abs($(i).offset().top+d-e)<d&&(t=$(i))}),t}var i,s,o,a,l,c,r,u,d,p,f=[];t.exports={init:function(e,t){i=e,s=t,$(i).on("mousedown",s,function(e){e.stopPropagation(),o=$(this),d=o.outerHeight()/2,u=e.pageY,p=u,c=e.pageX-o.offset().left,r=e.pageY-o.offset().top}),$(document).mousemove(function(e){if(e.pageY!==u){if(o&&!a){o.hasClass("label")&&o.find(".content").hide(),a=!0;var t=o.width(),i=o.outerHeight();o.replaceWith('<div class="dragging-placeholder"></div>'),$(".dragging-placeholder").height(i),o.addClass("dragging").width(t),o.css("left",o.offset().left),o.css("top",o.offset().top),o.detach().appendTo("body")}if(o){o.css("left","50px"),o.css("top",e.pageY-r);var i=o.outerHeight();l=n(e.pageY-r+d),void 0!==l&&($(".dragging-placeholder").remove(),p<e.pageY?l.hasClass("label")?l.find(".content").prepend($('<div class="dragging-placeholder"></div>')):$('<div class="dragging-placeholder"></div>').insertAfter(l):$('<div class="dragging-placeholder"></div>').insertBefore(l),$(".dragging-placeholder").height(i)),p=e.pageY}}}),$(document).mouseup(function(){o&&(a&&(o.css("left","auto"),o.css("top","auto"),o.removeClass("dragging"),$(".dragging-placeholder").replaceWith(o),a=!1,f.forEach(function(e){e()})),o=null)})},ended:function(e){f.push(e)}}},{}],3:[function(){"use strict";$.fn.keybindInput=function(e){this.on("keydown",e,function(e){e.preventDefault(),e.stopPropagation();var t="";e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.metaKey&&(t+="meta+");var n={8:"backspace",9:"tab",13:"enter",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del"},i=e.which>47&&e.which<58||e.which>64&&e.which<91||e.which>95&&e.which<112||e.which>185&&e.which<193||e.which>218&&e.which<223;if(i){var s=String.fromCharCode(e.which).toLowerCase();t+=s}else if(e.which in n){var s=n[e.which];t+=s}return(i||e.which in n)&&$(this).val(t),!1})},$.fn.isOverflowing=function(){var e=this.get(0),t=!1;return e.clientHeight<e.scrollHeight&&(t=!0),t},$.fn.id=function(){return this.prop("id").split("-")[1]}},{}],4:[function(e){!function(){"use strict";function t(){return Backbone.Router.extend({routes:{"":"podcasts",podcasts:"podcasts",episodes:"episodes",settings:"settings","now-playing":"nowPlaying",fullscreen:"fullscreen","p:n":"foo","*any":"podcasts"},podcasts:function(){$(".tab").hide(),wt?($("#tab-podcasts").show(),vt&&setTimeout(function(){vt.refresh(),gt.refresh()},0),yt&&(Jt=0,$(".col").hide(),$("#playbar").show(),$(".col:eq(0)").show()),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},episodes:function(){$(".tab").hide(),wt?($("#tab-episodes").show(),gt&&setTimeout(function(){mt.refresh()},0),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},settings:function(){$(".tab").hide(),wt?($("#tab-settings").show(),P(),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},foo:function(e){$(".tab").hide(),wt?($("#tab-podcasts").show(),vt&&setTimeout(function(){vt.refresh(),gt.refresh()},0),Jt=e,yt&&($(".col").hide(),$("#playbar").show(),$(".col:eq("+e+")").show(),2==Jt?($("#podcast-vmenu").hide(),$("#podcast-cols").css("left","0px")):($("#podcast-vmenu").show(),$("#podcast-cols").css("left","50px"))),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},nowPlaying:function(){$(".tab").hide(),wt?($("#vid-container").removeClass("thumb"),$("#vid-container").css("right",0),$("#tab-now-playing").show()):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},fullscreen:function(){$("#topbar").hide(),$("#vid-container").removeClass("thumb"),$("#vid-container").addClass("fs")}})}function n(e){$.post(lt+"library/casts",{feedurl:e},function(){Yt=!0,m()}),$("#input-vmenu-add").val(""),$("#input-vmenu-add").toggle(),$("#button-vmenu-add").toggle(),$("#vmenu-add-results").toggle()}function i(e){$("#input-vmenu-label").val(""),$("#input-vmenu-label").toggle(),$("#button-vmenu-label").toggle(),$.post(lt+"library/labels",{name:e},function(){D()})}function s(e){I(e);var t=W(e);t?($("#pretty img").prop("src",t),$("#pretty").show(),$(".pretty-button").css("line-height",$("#pretty img").height()+"px"),$("#pretty img").css("max-height",.4*$("#main-container").height()+"px")):$("#pretty").hide(),qt=e;var n=e in xt?xt[e]:St[e];$("#episode-title, #overlay-info h2").html(n.feed.title),$("#episode-date").html(new Date(n.feed.pubDate).toLocaleString()),$("#episode-desc").html(n.feed.description||" "),$("#episode-desc *").removeAttr("style"),$("#overlay-info h5").html(Tt[n.castid].feed.title),$("#episode-bar").show(),setTimeout(function(){$t.refresh()},0),z()}function o(e){qt=e,s(e),sessionStorage.selectedepisode=e,$("#episode-bar-play").html(Nt===e?Dt?"Play":"Pause":"Play"),$(".episode").removeClass("selected"),$("#ep-"+e).addClass("selected")}function a(e){if(Nt!==e&&(null!==Nt&&(Q("vid").paused||p(Wt.Play)),!(e in xt)&&e in St&&(xt[e]=St[e],delete St[e],ct.put("episodes",xt)),e in xt)){sessionStorage.lastepisode=JSON.stringify({id:e,castid:xt[e].castid}),s(e),Nt=e,null===xt[e].lastevent&&p(Wt.Start,e,0);var t="";_.isString(xt[e].feed.description)&&(t=xt[e].feed.description.replace(/(<([^>]+)>)/gi,"")),it.load(xt[e].feed.enclosure.url,{title:xt[e].feed.title,description:t,image:W(e)});var n=Q("vid");n.setAttribute("src",xt[e].feed.enclosure.url),n.load(),jt=!0,Ot=!1,n.playbackRate=Gt.Playback.PlaybackRate.value,e=xt[e].castid,It=[];for(var i in xt)xt[i].castid==e&&(xt[i].lastevent&&xt[i].lastevent.type==Wt.Delete||(It.push(xt[i]),i==Nt&&(Rt=It.length-1)));It.sort(function(e,t){var n=new Date(e.feed.pubDate),i=new Date(t.feed.pubDate);return n>i?-1:i>n?1:0}),$("#vid-container").removeClass("minimized")}}function l(e){if(e in xt){$("#ep-"+e).remove(),p(Wt.Delete,e);var t=$("#cast-"+xt[e].castid+" .n");t.html(t.html()-1),delete xt[ht],ct.put("episodes",xt)}}function c(){ot=$("#input-username").val(),lt=$("#input-target").val(),-1===lt.indexOf("/",lt.length-1)&&(lt+="/");var e=localStorage.uuid||et();$.post(lt+"account/login",{username:ot,password:$("#input-password").val(),clientname:"Castcloud",clientdescription:nt(),clientversion:"0.1",uuid:e},function(t){st=t.token,void 0!==st&&(localStorage.token=st,localStorage.username=ot,localStorage.uuid=e,localStorage[tt("apiTarget")]=lt,r(),$("#tab-podcasts").fadeIn("fast"),$("#playbar").slideDown("fast"),$("#topbar nav").fadeIn("fast"),$("#userinfo").fadeIn("fast"))}),$("#input-password").val("")}function r(){wt=!0,$("#userinfo span").html(ot),$(".tab").hide(),$("#main-container").css("bottom","55px"),"now-playing"!==Backbone.history.fragment&&$("#vid-container").addClass("thumb"),$.ajaxSetup({headers:{Authorization:st}}),u(),d()}function u(){var e=_.after(4,function(){v();var e=_.template($("script.labels").html());$("#add-to-label").empty().append(e({labels:rt}))}),t=_.after(2,function(){Ct.forEach(function(e){e.episodeid in xt&&(!xt[e.episodeid].lastevent||e.clientts>xt[e.episodeid].lastevent.clientts)&&(xt[e.episodeid].lastevent=e)})});ct=new IDBStore({storeName:tt("db"),keyPath:null},function(){kt=!0,console.log("IDB ready"),ct.get("labels",function(t){t&&(console.log("Labels loaded from IDB"),rt=t,e())}),ct.get("casts",function(t){t&&(console.log("Casts loaded from IDB"),Tt=t,e())}),ct.get("episodes",function(n){n&&(console.log("Episodes loaded from IDB"),xt=n,t(),e())}),ct.get("events",function(n){if(n){if(console.log("Events loaded from IDB"),Ct=n,"popout"!==window.name){if(localStorage.beforeunloadevent){var i=JSON.parse(localStorage.beforeunloadevent);console.log("pushing beforeunloadevent"),p(i.type,i.id,i.time),localStorage.removeItem("beforeunloadevent")}if(localStorage.unloadevent){var i=JSON.parse(localStorage.unloadevent);console.log("pushing unloadevent"),p(i.type,i.id,i.time),localStorage.removeItem("unloadevent")}}t(),e()}}),ct.get("settings",function(e){e&&(console.log("Settings loaded from IDB"),Gt=$.extend(!0,{},Lt,e),$(".thumb").width(Gt.__client.ThumbWidth.value),E(),x())}),ct.get("buffer_events",function(e){e&&(zt.events=e)}),ct.get("buffer_settings",function(e){e&&(zt.settings=e)});for(var n in zt.idb)ct.put(n,zt.idb[n]),console.log("Flushed "+n+" from IDB buffer")})}function d(e){D(),m(),H(),k(),zt.events.length>0&&f(),_.size(zt.settings)>0&&T(),e||setTimeout(d,1e3*Gt.Advanced.SyncInterval.value)}function p(e,t,n){if(!dt){var i=Z();_t===i?Ht++:Ht=0,_t=i,t=t||Nt,zt.events.push({type:e,episodeid:t,positionts:void 0===n?0|Q("vid").currentTime:n,concurrentorder:Ht,clientts:i}),ct.put("buffer_events",zt.events),f(),t in xt&&(xt[t].lastevent={type:e,positionts:void 0===n?0|Q("vid").currentTime:n,clientts:i,clientname:null,clientdescription:null});var s={clientdescription:"Best",clientname:"Castcloud",clientts:i,episodeid:t,name:Wt[e],positionts:void 0===n?0|Q("vid").currentTime:n,type:e},o=new Date(1e3*s.positionts);o.setHours(o.getHours()-1),s.position="",o.getHours()>0&&(s.position+=o.getHours()+"h "),s.position+=o.getMinutes()+"m "+o.getSeconds()+"s";var a=new Date(1e3*s.clientts);a.setHours(a.getHours()-1),s.date=a.toLocaleString(),Ct.unshift(s),ct.put("events",Ct),t==qt&&I(t)}}function f(){$.post(lt+"library/events",{json:JSON.stringify(zt.events)},function(){zt.events=[],ct.remove("buffer_events")})}function h(e){var t=lt+(void 0===e?"library/casts":"library/casts/"+e);$.ajax(t,{headers:{"If-None-Match":localStorage.etag_casts},type:"GET",success:function(e,t,n){if(200===n.status){var i=n.getResponseHeader("etag");i&&(localStorage.etag_casts=i),e.forEach(function(e){Tt[e.id]=e}),kt?ct.put("casts",Tt):zt.idb.casts=Tt,v()}}})}function v(){var e="";if(Vt||(e=md5(JSON.stringify(rt)+JSON.stringify(Tt))),e!==Ut){Ut=e;var t=_.template($("script.podcasts").html());if($("#podcasts").empty().append(t({labels:rt,casts:Tt})),z(),rt.root.forEach(function(e){"label"===e.type&&rt[e.id].expanded&&$("#label-"+e.id+" .content").show()}),vt?setTimeout(function(){vt.refresh()},0):vt=new IScroll("#foo",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0}),sessionStorage.selectedcast)null===Bt&&b(sessionStorage.selectedcast),Bt=sessionStorage.selectedcast,$("#cast-"+sessionStorage.selectedcast).addClass("selected");else if(sessionStorage.lastepisode){var n=JSON.parse(sessionStorage.lastepisode);b(n.castid)}var i={};for(var s in xt){var o=xt[s];o.castid in i?i[o.castid]++:i[o.castid]=1}for(var a in i)$("#cast-"+a+" .n").html(i[a]);$(".cast .n").each(function(e,t){$(t).html().length<1&&$(t).width(0)}),Yt&&(Yt=!1,g($("#podcasts > .cast:last-child").id()),setTimeout(function(){vt.scrollTo(0,vt.maxScrollY,0)},0)),Vt&&(Vt=!1,setTimeout(function(){Ut=md5(JSON.stringify(rt)+JSON.stringify(Tt))},0))}}function g(e){Bt=e,b(e),$(".cast").removeClass("selected"),$("#cast-"+e).addClass("selected"),sessionStorage.selectedcast=e}function m(){localStorage[tt("since")]||(localStorage[tt("since")]=0),console.log("fetching episodes since "+localStorage[tt("since")]),$.get(lt+"library/newepisodes",{since:localStorage[tt("since")]},function(e){localStorage[tt("since")]=e.timestamp,console.log(e.episodes.length+" episodes fetched"),e.episodes.length>0&&(ct.get("episodes",function(t){t=t||{},e.episodes.forEach(function(e){t[e.id]=e}),ct.put("episodes",t)}),e.episodes.forEach(function(e){xt[e.id]=e,Bt==e.castid&&$("#episodes").prepend('<div id="ep-'+e.id+'" class="episode">'+e.feed.title+'<div class="delete">Delete</div></div>')}),Bt==e.episodes[0].castid&&setTimeout(function(){gt.refresh()},0),Yt&&D())})}function b(e){var t=[];for(var n in xt)xt[n].castid==e&&(xt[n].lastevent&&xt[n].lastevent.type==Wt.Delete||t.push(xt[n]));if(t.length>0){t.sort(function(e,t){var n=new Date(e.feed.pubDate),i=new Date(t.feed.pubDate);return n>i?-1:i>n?1:0});var i=_.template($("script.episodes").html());if($("#episodes").empty().append(i({episodes:t})),U(),sessionStorage.lastepisode){var o=JSON.parse(sessionStorage.lastepisode);o.id in xt&&a(o.id),$("#ep-"+o.id).addClass("selected")}else sessionStorage.selectedepisode&&(s(sessionStorage.selectedepisode),$("#ep-"+sessionStorage.selectedepisode).addClass("selected"))}else $("#episodes").empty().append('<div class="episodes-empty"><h2>There are no episodes left</h2><button id="show-all-episodes" class="button">Show me everything!</button></div>');gt?setTimeout(function(){gt.refresh()},0):gt=new IScroll("#foo2",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0})}function y(e){$.get(lt+"library/episodes/"+e,function(e){St={},e.forEach(function(e){St[e.id]=e});var t=_.template($("script.episodes").html());$("#episodes").empty().append(t({episodes:e})),gt?setTimeout(function(){gt.refresh()},0):gt=new IScroll("#foo2",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0}),U()})}function w(e){if(e===Nt)B(0);else{!(e in xt)&&e in St&&(xt[e]=St[e],delete St[e],ct.put("episodes",xt)),p(Wt.Pause,e,0),U();var t=$("#cast-"+xt[e].castid+" .n");t.html(parseInt(t.html())+1)}}function k(){var e=lt+"account/settings";$.ajax(e,{headers:{"If-None-Match":localStorage.etag_settings},type:"GET",success:function(e,t,n){if(200===n.status){var i=n.getResponseHeader("etag");i&&(localStorage.etag_settings=i),Gt={},e.forEach(function(e){var t=e.setting.split("/")[0],n=e.setting.split("/")[1];void 0===n&&(n=t,t="General"),void 0===Gt[t]&&(Gt[t]={}),Gt[t][n]={value:e.value,clientspecific:e.clientspecific}}),Gt=$.extend(!0,{},Lt,Gt),E(),x(),kt?ct.put("settings",Gt):zt.idb.settings=Gt}}})}function x(e){var t="";if(void 0!==e||Qt||(t=md5(JSON.stringify(Gt))),e||t!==Xt){Xt=t,$("#settings-menu").empty(),$("#settings-panel").empty();for(var n in Gt){$("#settings-menu").append('<p class="setting-button" id="setting-'+n+'">'+n+"</p>");var i=$('<div class="setting-panel" id="setting-panel-'+n+'"><h2>'+n+"</h2></div>");"General"===n&&(i.append('<h3>OPML</h3><p><button class="button" id="import-opml">Import</button><input type="file" id="hax" style="display:none"><button class="button" id="opml">Export</button></p><h3>Local data<span class="used"></span></h3><button class="button" id="clear-local-data">Clear</button><h3>Default settings</h3><button class="button" id="reset-settings">Reset</button>'),P());for(var s in Gt[n]){var o=n+"_"+s,a=Gt[n][s];a.type===At.Keybind?i.append("<p><label>"+s+'</label><input type="text" id="'+o+'" class="setting keybind" value="'+a.value+'"></p>'):a.type===At.Bool?(i.append("<p><label>"+s+'</label><input type="checkbox" id="'+o+'" class="setting"></p>'),i.find("#"+o).prop("checked","true"==String(a.value))):i.append("<p><label>"+s+'</label><input type="text" id="'+o+'" class="setting" value="'+a.value+'"></p>')}$("#settings-panel").append(i)}$("#setting-General").addClass("selected"),$("#setting-panel-General").show(),Qt&&(Qt=!1,setTimeout(function(){Xt=md5(JSON.stringify(Gt))},0))}}function S(e,t,n){n=n||"General",Gt[n][e].value=t,Xt=md5(JSON.stringify(Gt)),zt.settings.push({setting:n+"/"+e,value:t,clientspecific:Gt[n][e].clientspecific}),ct.put("buffer_settings",zt.settings),T(),ct.put("settings",Gt),"Keybinds"===n&&E()}function T(){$.post(lt+"account/settings",{json:JSON.stringify(zt.settings)},function(){zt.settings=[],ct.remove("buffer_settings")})}function C(){Gt=Lt;for(var e in Gt)for(var t in Gt[e])zt.settings.push({setting:e+"/"+t,value:Gt[e][t].value,clientspecific:Gt[e][t].clientspecific});ct.put("buffer_settings",zt.settings),T(),ct.put("settings",Gt),x(!0),E()}function P(){navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota(function(e){$(".used").html((e/1024/1024).toFixed(2)+" MB")})}function E(){Mousetrap.reset(),Mousetrap.bind(Gt.Keybinds.PlayPause.value,R),Mousetrap.bind(Gt.Keybinds.Next.value,F),Mousetrap.bind(Gt.Keybinds.Previous.value,A),Mousetrap.bind(Gt.Keybinds.SkipForward.value,K),Mousetrap.bind(Gt.Keybinds.SkipBack.value,j)}function D(){var e=lt+"library/labels";$.ajax(e,{type:"GET",headers:{},success:function(e,t,n){if(200===n.status){var i=n.getResponseHeader("etag");i&&(localStorage.etag_labels=i),rt={},e.forEach(function(e){"root"===e.name&&(ut=e.id),rt[e.name]=[],e.content&&e.content.split(",").forEach(function(t){var n=t.split("/");rt[e.name].push({type:n[0],id:parseInt(n[1])})}),rt[e.id]={name:e.name,expanded:e.expanded}});var s=_.template($("script.labels").html());$("#add-to-label").empty().append(s({labels:rt})),kt?ct.put("labels",rt):zt.idb.labels=rt,h()}},error:function(){h()}})}function O(){var e=[];$("#podcasts > div").each(function(t,n){e.push($(n).prop("id").replace("-","/"))}),$.ajax(lt+"library/labels/"+ut,{type:"PUT",data:{content:e.join()}}),$("#podcasts .label").each(function(t,n){e=[],$(n).find(".cast").each(function(t,n){e.push($(n).prop("id").replace("-","/"))}),$.ajax(lt+"library/labels/"+$(n).id(),{type:"PUT",data:{content:e.join(),expanded:$(n).find(".content").is(":visible")}})})}function H(){localStorage[tt("since-events")]||(localStorage[tt("since-events")]=0),console.log("fetching events since "+localStorage[tt("since-events")]),$.get(lt+"library/events",{since:localStorage[tt("since-events")],exclude_self:!0},function(e){localStorage[tt("since-events")]=e.timestamp,e.events.forEach(function(e){var t=new Date(1e3*e.positionts);t.setHours(t.getHours()-1),e.position="",t.getHours()>0&&(e.position+=t.getHours()+"h "),e.position+=t.getMinutes()+"m "+t.getSeconds()+"s";var n=new Date(1e3*e.clientts);n.setHours(n.getHours()-1),e.date=n.toLocaleString(),e.name=Wt[e.type],e.episodeid in xt&&(!xt[e.episodeid].lastevent||e.clientts>xt[e.episodeid].lastevent.clientts)&&(xt[e.episodeid].lastevent=e),Ct.unshift(e)}),e.events.length>0&&(Ct.sort(function(e,t){return e.clientts>t.clientts?-1:e.clientts<t.clientts?1:e.concurrentorder>t.concurrentorder?-1:e.concurrentorder<t.concurrentorder?1:0}),kt?ct.put("events",Ct):zt.idb.events=Ct,null!==qt&&I(qt)),console.log(e.events.length+" events fetched")})}function I(e){for(var t=[],n=0;n<Ct.length&&(Ct[n].episodeid!=e||(t.push(Ct[n]),10!==t.length));n++);var i=_.template($("script.events").html());$("#events").empty().append(i({events:t}))}function R(){Dt?N():q(),dt&&X({action:"playPause"})}function N(){it.running()?it.play():Q("vid").play(),Ot=!1,Dt=!1,p(Wt.Play),$(".button-play i").addClass("fa-pause"),$(".button-play i").removeClass("fa-play"),U(),$("#episode-bar-play").html("Pause"),$(".pretty-overlay").hide()}function q(){it.running()?it.pause():Q("vid").pause(),Dt=!0,p(Wt.Pause),$(".button-play i").addClass("fa-play"),$(".button-play i").removeClass("fa-pause"),U(),$("#episode-bar-play").html("Play"),$(".pretty-overlay").show()}function B(e){dt?X({action:"seek",time:e}):it.running()?it.seek(e):Q("vid").currentTime=e;var t=1/bt*e;$("#seekbar div").css("width",$("#seekbar").width()*t+"px"),$("#badeball").css("left",$("#seekbar").width()*t-10+"px")}function j(){if(dt)X({action:"skipBack"});else{it.running()&&(ft-=15,it.seek(ft));var e=Q("vid");p(Wt.Pause),e.currentTime=e.currentTime-15,p(Wt.Play),e.paused&&p(Wt.Pause)}}function K(){if(dt)X({action:"skipForward"});else{it.running()&&(ft+=15,it.seek(ft));var e=Q("vid");p(Wt.Pause),e.currentTime=e.currentTime+15,p(Wt.Play),e.paused&&p(Wt.Pause)}}function M(){dt&&X({action:"muteToggle"});var e=Q("vid");e.muted=!e.muted,it.mute(e.muted),e.muted?($("#volume i").removeClass("fa-volume-up"),$("#volume i").addClass("fa-volume-off"),$("#volume .bar .inner").css("width",0)):($("#volume i").removeClass("fa-volume-off"),$("#volume i").addClass("fa-volume-up"),$("#volume .bar .inner").css("width",60*e.volume+"px"))}function J(e){0>e?e=0:e>1&&(e=1),dt&&X({action:"volume",volume:e}),it.volume(e);var t=Q("vid");t.volume=e,$("#volume .bar .inner").css("width",60*t.volume+"px"),0===e?($("#volume i").removeClass("fa-volume-up"),$("#volume i").addClass("fa-volume-off")):(t.muted=!1,$("#volume i").removeClass("fa-volume-off"),$("#volume i").addClass("fa-volume-up"))}function F(){"true"==String(Gt.Playback.KeepPlaying.value)&&(Rt++,Rt<It.length&&(Et=!0,a(It[Rt].id)))}function A(){console.log("previousEpisode called")}function L(){var e=Q("vid-container");$("#vid-container").hasClass("fs")?(document.webkitExitFullscreen(),$("#playbar-fullscreen").removeClass("fa-compress").addClass("fa-expand")):(e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),$("#playbar-fullscreen").removeClass("fa-expand").addClass("fa-compress"))}function G(e){var t=new Date(1e3*e),n=new Date(1e3*bt),i=1/bt*e;t.setHours(t.getHours()-1),n.setHours(n.getHours()-1);var s="";if(t.getHours()>0&&(s+=t.getHours().pad()+":"),s+=t.getMinutes().pad()+":"+t.getSeconds().pad()+"/",n.getHours()>0&&(s+=n.getHours().pad()+":"),s+=n.getMinutes().pad()+":"+n.getSeconds().pad(),"popout"===window.name&&e>0){var o=new window.Event("timeupdate");o.data={time:e},window.dispatchEvent(o)}$("#time").html(s),$("#seekbar").is(":visible")&&($("#seekbar div").css("width",$("#seekbar").width()*i+"px"),$("#badeball").css("left",$("#seekbar").width()*i-10+"px"))}function W(e){var t=e in xt?xt[e]:St[e],n=Tt[t.castid];return t.feed["media:thumbnail"]?t.feed["media:thumbnail"].url:t.feed["itunes:image"]?t.feed["itunes:image"].href:n.feed["itunes:image"]?n.feed["itunes:image"].href:n.feed.image?n.feed.image.url:null}function z(){$("#episodeinfo").isOverflowing()?$("#vid-container.thumb").css("right","15px"):$("#vid-container.thumb").css("right","1px")}function U(){$(".episode i").remove(),$(".episode").each(function(e,t){var n=$(t).id(),i=n in xt?xt[n]:St[n];n!==Nt||Ot?null!==i.lastevent&&(i.lastevent.type>=Wt.EndOfTrack?$("#ep-"+n).append('<i class="fa fa-circle progress"></i>'):i.lastevent.positionts>0&&$("#ep-"+n).append('<i class="fa fa-circle-o progress"></i>')):$("#ep-"+n).append(jt?'<i class="fa fa-spinner fa-spin"></i>':Dt?'<i class="fa fa-pause"></i>':'<i class="fa fa-play"></i>')})}function X(e){dt.postMessage(JSON.stringify(e),"*")}function Y(){$("#cast-overlay").css("line-height",$("#cast-overlay").height()+"px")}function V(e,t,n){ht=$(t).id(),$(e).css("left",n.pageX+"px"),$(e).css("top",n.pageY+"px"),$(".context-menu").hide(),$(e).show(),n.preventDefault()}function Q(e){return $("#"+e)[0]}function Z(){return $.now()/1e3|0}function et(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function tt(e){return ot+"-"+e}function nt(){var e=(new UAParser).getResult(),t=e.browser.name?e.browser.name+", ":"";return t+=e.os.name?e.os.name+" "+e.os.version+", ":"",t+=e.device.vendor?e.device.vendor+" "+e.device.model:"",-1!==t.indexOf(" ",t.length-1)&&(t=t.substr(0,t.length-2)),t}{var it=e("./chromecast.js");e("./dragdrop.js")}e("./jquery-plugins.js");var st,ot,at,lt,ct,rt,ut,dt,pt,ft,ht,vt,gt,$t,mt,bt,yt,wt=!1,kt=!1,xt={},St={},Tt={},Ct=[],Pt=!1,Et=!1,Dt=!1,Ot=!1,_t=null,Ht=0,It=[],Rt=0,Nt=null,qt=null,Bt=null,jt=!1,Kt=null,Mt=null,Jt=0,Ft=!1,At={Text:0,Bool:1,Keybind:2},Lt={General:{},Playback:{KeepPlaying:{type:At.Bool,value:!0},PlaybackRate:{type:At.Text,value:1}},Keybinds:{PlayPause:{type:At.Keybind,value:"space"},Next:{type:At.Keybind,value:"pageup"},Previous:{type:At.Keybind,value:"pagedown"},SkipForward:{type:At.Keybind,value:"right"},SkipBack:{type:At.Keybind,value:"left"}},Advanced:{SyncInterval:{type:At.Text,value:10}},__client:{ThumbWidth:{value:200,clientspecific:!0}}},Gt=Lt,Wt={Start:10,Pause:20,Play:30,SleepStart:40,SleepEnd:50,EndOfTrack:60,Delete:70,10:"Start",20:"Pause",30:"Play",40:"Sleep Started",50:"Sleep Ended",60:"End Of Track",70:"Delete"},zt={events:[],settings:[],idb:{}};it.init("3EC703A8"),it.session(function(){$(".cc img").prop("src","img/cast_on.png"),Q("vid").pause(),$("#cast-overlay").show(),Y()}),it.receiver(function(e){e>0?$(".cc").show():$(".cc").hide()}),it.mediaLoaded(function(){it.seek(Q("vid").currentTime),Dt&&it.pause()}),it.timeUpdate(function(e){G(e),ft=e}),$(document).ready(function(){function e(e){var t=1/$("#seekbar").width()*(e-$("#seekbar").position().left)*bt,n=new Date(1e3*t);n.setHours(n.getHours()-1);var i="";n.getHours()>0&&(i+=n.getHours().pad()+":"),i+=n.getMinutes().pad()+":"+n.getSeconds().pad(),$("#seektime").css("left",e-$("#seektime").outerWidth()/2+"px"),$("#seektime").html(i)}var s=t(),u=new s;u.bind("all",function(){z(),Y(),$("#overlay-info").hide()});var f=window.location.pathname;at=f.substr(0,f.indexOf("client/")+7),lt=localStorage[tt("apiTarget")]||window.location.protocol+"//"+window.location.host+at.replace("client","api"),$("#input-target").val(lt),localStorage.username&&(ot=localStorage.username,$("#input-username").val(ot)),$("#podcasts").on("click",".cast",function(){u.navigate("p1",{trigger:!0})}),$("#episodes").on("click",".episode",function(){u.navigate("p2",{trigger:!0})}),yt="100%"===$(".col").css("width"),$(window).resize(function(){yt=window.innerWidth<665,!Ft&&yt?($(".col").hide(),$(".col:eq("+Jt+")").show(),2===Jt?($("#podcast-vmenu").hide(),$("#podcast-cols").css("left","0px")):($("#podcast-vmenu").show(),$("#podcast-cols").css("left","50px"))):Ft&&!yt&&($(".col").show(),$("#podcast-vmenu").show(),$("#podcast-cols").css("left","50px")),$(".pretty-button").css("line-height",$("#pretty img").height()+"px"),$("#pretty img").css("max-height",.4*$("#main-container").height()+"px"),Ft=yt}),$("#navicon").click(function(){$("#menu-container").toggle()}),$("a").click(function(e){e.preventDefault();var t=e.target.pathname.substr(at.length,e.target.pathname.length-at.length+1);u.navigate(t,{trigger:!0})}),$("#vid").on("timeupdate",function(){var e=Q("vid");G(e.currentTime)}),$("#vid").click(function(){R()}),$("#vid").dblclick(function(){L()}),$("#vid-thumb-bar .popout").click(function(){var e=Q("vid");p(Dt?Wt.Pause:Wt.Play),e.setAttribute("src","#"),e.load(),dt=window.open(at+"fullscreen","popout","toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=0,top=0"),$(dt).on("beforeunload",function(){dt=null;var e=Nt;Nt=null,a(e)}),$(dt).on("timeupdate",function(e){G(e.originalEvent.data.time)}),$(dt).on("unload",function(){if(localStorage.beforeunloadevent){var e=JSON.parse(localStorage.beforeunloadevent);p(e.type,e.id,e.time),localStorage.removeItem("unloadevent"),localStorage.removeItem("beforeunloadevent")}})}),$("#vid-thumb-bar .minimize").click(function(){$("#vid-container").toggleClass("minimized")}),"popout"===window.name&&$(window).on("message",function(e){var t=JSON.parse(e.originalEvent.data);switch(t.action){case"playPause":R();break;case"skipForward":K();break;case"skipBack":j();break;case"seek":B(t.time);break;case"muteToggle":M();break;case"volume":J(t.volume)}}),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){$("#vid-container").toggleClass("fs"),$("#vid-container").hasClass("fs")?($("#vid-container").removeClass("thumb"),$("#playbar").detach().appendTo("#vid-container"),$("#playbar").show()):("now-playing"!==Backbone.history.fragment&&$("#vid-container").addClass("thumb"),$("#playbar").detach().appendTo("body"),$("#playbar").show(),null!==h&&clearTimeout(h),$("#overlay-info").stop().hide())});var h=null;$("#vid-container").mousemove(function(){v||($(this).hasClass("fs")?($("#playbar").show(),$("#overlay-info").fadeIn("fast"),null!==h&&clearTimeout(h),h=setTimeout(function(){$("#playbar").hide(),$("#overlay-info").stop().fadeOut("fast")},1e3)):"0px"==$(this).css("right")&&($("#overlay-info").fadeIn("fast"),null!==h&&clearTimeout(h),h=setTimeout(function(){$("#overlay-info").stop().fadeOut("fast")},1e3)))});var v=!1;$("#playbar").mouseover(function(){v=!0,$(this).parent().hasClass("fs")&&null!==h&&clearTimeout(h),$("#badeball").css("height","20px").css("width","20px").css("top","-5px").css("margin-left","0px"),$("#seekbar").css("height","10px")}),$("#playbar").mouseout(function(){v=!1,$(this).parent().hasClass("fs")&&(h=setTimeout(function(){$("#playbar").hide(),$("#overlay-info").fadeOut("fast")},1e3)),m||($("#seekbar").css("height","5px"),$("#badeball").css("height","0px").css("width","0px").css("top","2.5px").css("margin-left","10px"))}),$(window).on("beforeunload",function(){null!==Nt&&(Dt||Ot||(localStorage.beforeunloadevent=JSON.stringify({type:Wt.Play,id:Nt,time:0|Q("vid").currentTime})))}),$(window).on("unload",function(){null!==Nt&&(Dt||Ot||(localStorage.unloadevent=JSON.stringify({type:Wt.Play,id:Nt,time:0|Q("vid").currentTime})))}),$(".button-skipback").click(function(){j()}),$(".button-play").click(function(){R()}),$(".button-skipforward").click(function(){K()}),$("#vid").on("loadstart",function(){$("#ep-"+Nt+" i").length>0&&$("#ep-"+Nt+" i").remove(),$("#vid-container").hide(),U()
}),$("#vid").on("canplay",function(){var e=Q("vid");e.videoWidth>0?(pt="video",$("#vid-container").removeClass("audio"),$("#vid-container").show()):($("#vid-art").prop("src",W(Nt)),pt="audio",$("#vid-container").show(),$("#vid-container").addClass("audio")),Y(),bt=e.duration;var t=xt[Nt].lastevent;t&&t.type==Wt.EndOfTrack&&(Ot=!0,Dt=!0),null!==t&&jt&&t.type!=Wt.EndOfTrack&&(e.currentTime=t.positionts,t.type==Wt.Play?N():q()),Et&&jt&&(Et=!1,t&&t.type==Wt.EndOfTrack||N()),jt=!1,U()}),$("#vid").on("ended",function(){p(Wt.EndOfTrack),$("#vid-container").hide(),Ot=!0,U(),F()});var m=!1;$("#seekbar").mousedown(function(e){p(Wt.Pause),B(1/$("#seekbar").width()*(e.pageX-$("#seekbar").position().left)*bt),m=!0}),$("#badeball").mousedown(function(e){p(Wt.Pause),B(1/$("#seekbar").width()*(e.pageX-$("#seekbar").position().left)*bt),m=!0}),$("#seekbar").mouseover(function(){}),$("#seekbar").mouseout(function(){m||$("#seektime").hide()}),$("#seekbar").mousemove(function(t){e(t.pageX)}),$(document).mouseup(function(){X=!1,m&&($("#seektime").hide(),$("#seekbar").css("height","5px"),$("#badeball").css("height","0px").css("width","0px").css("top","5px"),m=!1,p(Wt.Play),Q("vid").paused&&p(Wt.Pause)),x&&(x=!1,k||$("#volume .bar").hide())}),$(document).mousemove(function(t){if(X){var n=$(".thumb"),i=window.innerWidth-t.pageX-Z-(window.innerWidth-(n.offset().left+n.width()));n.css("width",i+"px"),S("ThumbWidth",i,"__client")}m&&(B(1/$("#seekbar").width()*(t.pageX-$("#seekbar").position().left)*bt),e(t.pageX)),x&&J(1/60*(t.pageX-$("#volume .bar .inner").position().left))}),$("#playbar-gear").click(function(){$("#playbar-gear-menu").toggle()}),$("#playbar-fullscreen").click(L),$(".playback-rate").click(function(){var e=$(this).attr("rate");$(".playback-rate").removeClass("selected"),$(this).addClass("selected"),Q("vid").playbackRate=e,S("PlaybackRate",e,"Playback")}),$("#button-login").click(c),$("#input-password").keydown(function(e){13===e.which&&c()}),$("#button-logout").click(function(){localStorage.removeItem("token"),$("#vid-container").hide(),$("#playbar").hide(),$("#topbar nav").hide(),$("#userinfo").hide(),$(".tab").hide(),$("#tab-login").show()}),$("#vmenu-add").click(function(){var e=$(".vmenu-toggle:visible");$("#input-vmenu-add").toggle(),$("#button-vmenu-add").toggle(),$("#vmenu-add-results").toggle(),e.hide(),$("#input-vmenu-add").focus(),$("#input-vmenu-add:visible").length>0&&vt.scrollTo(0,0)}),$("#button-vmenu-add").click(function(){n($("#input-vmenu-add").val())}),$("#input-vmenu-add").keydown(function(e){e.stopPropagation();var t=$("#vmenu-add-results p.selected");if(13===e.which)t.length>0?(n(t.attr("feed-url")),t.parent().empty()):n($(this).val());else if(40===e.which){var i=$("#vmenu-add-results p"),s=t.removeClass("selected").index();s++,s>i.length-1&&(s=0),$(i.get(s)).addClass("selected")}else if(38===e.which){var i=$("#vmenu-add-results p"),s=t.removeClass("selected").index();s--,0>s&&(s=i.length-1),$(i.get(s)).addClass("selected")}});var b;$("#input-vmenu-add").keyup(function(e){if(40!==e.which&&38!==e.which){clearTimeout(b);var t=$(this).val();b=setTimeout(function(){$.ajax({url:"http://itunes.apple.com/search",jsonp:"callback",dataType:"jsonp",data:{media:"podcast",term:t,limit:5},success:function(e){$("#vmenu-add-results").empty(),e.results.forEach(function(e){$("#vmenu-add-results").append('<p feed-url="'+e.feedUrl+'">'+e.trackName+"</p>")}),$("#vmenu-add-results p:first-child").addClass("selected")}})},100)}}),$("#vmenu-add-results").on("click","p",function(){n($(this).attr("feed-url")),$(this).parent().empty()}),$("#vmenu-label").click(function(){var e=$(".vmenu-toggle:visible");$("#input-vmenu-label").toggle(),$("#button-vmenu-label").toggle(),e.hide(),$("#input-vmenu-label").focus(),$("#input-vmenu-label:visible").length>0&&vt.scrollTo(0,0)}),$("#button-vmenu-label").click(function(){i($("#input-vmenu-label").val())}),$("#input-vmenu-label").keydown(function(e){13===e.which&&i($(this).val())}),$("#vmenu-sync").click(function(){d(!0)}),z(),$(window).resize(function(){$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"),z()}),$(document).click(function(){$(".context-menu").hide()}),$("#volume i").click(function(){M()});var k=!1;$("#volume").mouseover(function(){$("#volume .bar").show(),k=!0}),$("#volume").mouseout(function(){x||$("#volume .bar").hide(),k=!1});var x=!1;$("#volume .bar").mousedown(function(e){J(1/60*(e.pageX-$("#volume .bar .inner").position().left)),x=!0}),$("#podcasts").on("contextmenu",".cast",function(e){e.stopPropagation(),V("#cast-context-menu",this,e)}),$("#podcasts").on("contextmenu",".label",function(e){V("#label-context-menu",this,e)}),$("#episodes").on("contextmenu",".episode",function(e){V("#episode-context-menu",this,e)}),$("#podcasts").on("mouseover",".cast",function(){Kt=$(this).id()}),$("#podcasts").on("mouseout",".cast",function(){Kt=null}),$("#episodes").on("mouseover",".episode",function(){Mt=$(this).id()}),$("#episodes").on("mouseout",".episode",function(){Mt=null});var T,H=!1;$(document).keydown(function(e){H=e.shiftKey,(e.ctrlKey||e.metaKey)&&(clearTimeout(T),T=setTimeout(function(){Pt=!1},1e3),Pt=!0,$(e.target).is("input:visible,textarea:visible")||window.getSelection().toString()||(null!==Kt?$("#clip").val(Tt[Kt].url).focus().select():null!==Mt&&$("#clip").val(xt[Mt].feed.enclosure.url).focus().select()))}),$(document).keyup(function(){Pt=!1,H=!1}),$("#cast-context-show-all").click(function(){y(ht)}),$("#cast-context-rename").click(function(){var e=$("#cast-"+ht+" .name").html();$("#cast-"+ht+" .name").html('<input type="text">'),$(".cast input").focus(),$(".cast input").val(e),$(".cast input").keydown(function(e){if(13===e.which){var t=$(this).val();$(this).parent().html(t),$.ajax(lt+"library/casts/"+ht,{type:"PUT",data:{name:t}})}})}),$("#cast-context-unsub").click(function(){$(".cast.selected").each(function(){var e=$(this).id();$("#cast-"+e).remove(),$.ajax(lt+"library/casts/"+e,{type:"DELETE"})}),$("#cast-"+ht).remove(),$.ajax(lt+"library/casts/"+ht,{type:"DELETE",success:function(){D()}})});var I;$("#cast-context-label").click(function(){$("#add-to-label").show(),I=vt.y,vt.scrollTo(0,0)}),$("#add-to-label").on("click","p",function(){$("#add-to-label").hide();$(this).id();vt.scrollTo(0,I)}),$("#label-context-rename").click(function(){var e=$("#label-"+ht+" .name span").html();$("#label-"+ht+" .name span").html('<input type="text">'),$(".label input").focus(),$(".label input").val(e),$(".label input").keydown(function(e){if(13===e.which){var t=$(this).val();$(this).parent().html(t),$.ajax(lt+"library/labels/"+ht,{type:"PUT",data:{name:t}})}})}),$("#label-context-delete").click(function(){$("#label-"+ht+" .cast").detach().appendTo("#podcasts"),$("#label-"+ht).remove(),setTimeout(function(){vt.refresh()},0),$.ajax(lt+"library/labels/"+ht,{type:"DELETE"})}),$("#episode-context-play").click(function(){Et=!0,o(ht),a(ht)}),$("#episode-context-reset").click(function(){w(ht)}),$("#episode-context-delete").click(function(){$("#"+ht).hasClass("selected")||l(ht),$(".episode.selected").each(function(){l($(this).id())})}),$("#input-target").keyup(function(){var e=$(this).val();-1===e.indexOf("/",e.length-1)&&(e+="/"),$.ajax(e+"account/ping",{type:"GET",error:function(e){"Bad token"===e.responseText?$("#input-target-container i").show():$("#input-target-container i").hide()},success:function(){$("#input-target-container i").hide()}})}),$("#pretty").click(function(){qt!==Nt?(Et=!0,a(qt)):R()}),$("#pretty img").load(function(){$("#pretty img").css("max-height",.4*$("#main-container").height()+"px"),$(".pretty-button").css("line-height",$(this).height()+"px")}),$("#episode-bar-events").click(function(){$("#events").css("left","66.666666%")}),$("#episode-bar-play").click(function(){qt!==Nt?(Et=!0,a(qt)):R()}),$("#events").on("click","#events-close",function(){$("#events").css("left","100%")}),$("#events").on("click","div",function(){$("#events").css("left","100%");var e=$(this).attr("event-type"),t=Q("vid");t.currentTime=$(this).attr("event-position"),it.seek($(this).attr("event-position")),e==Wt.Start||e==Wt.Play?t.play():t.pause()}),$(".cc").click(function(){it.running()?($(".cc img").prop("src","img/cast_off.png"),it.stop(),$("#cast-overlay").hide(),Q("vid").currentTime=ft,N()):($(".cc img").prop("src","img/cast_on.png"),it.start(),it.load(xt[Nt].feed.enclosure.url,{title:xt[Nt].feed.title,description:xt[Nt].feed.description,image:W(Nt)}))}),$("#podcasts").on("click",".label .name",function(){$(this).parent().find(".content").toggle(),$(this).find("i").hasClass("fa-angle-down")?($(this).find("i").removeClass("fa-angle-down"),$(this).find("i").addClass("fa-angle-up")):($(this).find("i").removeClass("fa-angle-up"),$(this).find("i").addClass("fa-angle-down")),setTimeout(function(){vt.refresh()},0),O()}),$("#podcasts").on("click",".cast",function(){if(Pt)$(this).toggleClass("selected");else if(H){if($(this).parent()[0]==$("#cast-"+Bt).parent()[0]){var e=$("#cast-"+Bt).index(),t=$(this).index(),n=$(this).parent().find(".cast");e>t?t--:t++,n.removeClass("selected"),_.range(e,t,e>t?-1:1).forEach(function(e){$(n.get(e)).addClass("selected")})}}else{var i=$(this).id();g(i)}}),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){Y()}),$("#episodes").on("click",".episode",function(){if(Pt)$(this).toggleClass("selected"),$(this).children(".bar").toggle();else if(H){var e=$("#ep-"+qt).index(),t=$(this).index(),n=$(".episode");e>t?t--:t++,n.removeClass("selected"),_.range(e,t,e>t?-1:1).forEach(function(e){$(n.get(e)).addClass("selected")})}else o($(this).id())}),$("#episodes").on("dblclick",".episode",function(){var e=$(this).id();Et=!0,a(e)}),$("#episodes").on("click",".delete",function(e){e.stopPropagation();var t=$(this).parent().id();l(t)}),$("#episodes").on("click",".reset",function(e){e.stopPropagation();var t=$(this).parent().id();w(t),$(this).hide();var n=$("#cast-"+xt[t].castid+" .n");n.html(parseInt(n.html())+1)}),$("#episodes").on("mouseover",".episode",function(){if($(this).children(".progress").css("color","#FFF"),$(this).find(".fa-circle").length>0){var e=$(this).id(),t=e in xt?xt[e]:St[e];$(this).children(".delete, .reset").show(),t.lastevent.type==Wt.Delete?$(this).children(".delete").html("Reset").removeClass("delete").addClass("reset"):$(this).children(".reset").html("Delete").removeClass("reset").addClass("delete")}}),$("#episodes").on("mouseout",".episode",function(){$(this).children(".progress").css("color","#666"),$(this).children(".delete, .reset").hide()}),$("#episodes").on("click","#show-all-episodes",function(){y(Bt)}),$("body").on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),$("body").on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.files[0],n=new FileReader;n.onload=function(){$.post(lt+"library/casts.opml",{opml:n.result})},n.readAsText(t)}),$("#settings-panel").on("click","#opml",function(){$.get(lt+"library/casts.opml",function(e){var t=window.document.createElement("a");t.href=window.URL.createObjectURL(new Blob([e],{type:"text/plain"})),t.download="casts.opml",document.body.appendChild(t),t.click(),document.body.removeChild(t)})}),$("#settings-panel").on("click","#import-opml",function(){$("#hax").click()}),$("#settings-panel").on("change","#hax",function(e){var t=e.target.files[0],n=new FileReader;n.onload=function(){$.post(lt+"library/casts.opml",{opml:n.result})},n.readAsText(t)}),$("#settings-panel").on("click","#clear-local-data",function(){ct.clear(function(){setTimeout(P,1e3)}),localStorage.clear(),sessionStorage.clear()}),$("#settings-panel").on("click","#reset-settings",C);var A;$("#tab-settings").on("keyup",".setting",function(){clearTimeout(A);var e=$(this).prop("id").split("_"),t=$(this).val();A=setTimeout(function(){S(e[1],t,e[0])},500)}),$("#tab-settings").on("change","checkbox.setting",function(){var e=$(this).prop("id").split("_"),t=$(this).prop("checked");S(e[1],t,e[0])}),$("#tab-settings").keybindInput(".keybind");var X=!1,Z=0;$("#vid-thumb-bar .drag").mousedown(function(e){X=!0,Z=e.pageX-$(".thumb").offset().left}),$("#settings-menu").on("click","p",function(){var e=$(this).id();$(".setting-panel").hide(),$(".setting-button").removeClass("selected"),$("#setting-"+e).addClass("selected"),$("#setting-panel-"+e).show()}),E(),$t=new IScroll("#episodeinfo",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0}),localStorage.token&&(st=localStorage.token,r(),$("#playbar").show(),$("#topbar nav").show(),$("#userinfo").show()),Backbone.history.start({pushState:!0,root:at})});var Ut,Xt,Yt=!1,Vt=!0,Qt=!0;Number.prototype.pad=function(){for(var e=this.toString();e.length<2;)e="0"+e;return e}}()},{"./chromecast.js":1,"./dragdrop.js":2,"./jquery-plugins.js":3}]},{},[4]);