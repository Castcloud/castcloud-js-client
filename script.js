!function(){var e=function(e,t){var a=e[0],r=e[1],l=e[2],c=e[3];a=n(a,r,l,c,t[0],7,-680876936),c=n(c,a,r,l,t[1],12,-389564586),l=n(l,c,a,r,t[2],17,606105819),r=n(r,l,c,a,t[3],22,-1044525330),a=n(a,r,l,c,t[4],7,-176418897),c=n(c,a,r,l,t[5],12,1200080426),l=n(l,c,a,r,t[6],17,-1473231341),r=n(r,l,c,a,t[7],22,-45705983),a=n(a,r,l,c,t[8],7,1770035416),c=n(c,a,r,l,t[9],12,-1958414417),l=n(l,c,a,r,t[10],17,-42063),r=n(r,l,c,a,t[11],22,-1990404162),a=n(a,r,l,c,t[12],7,1804603682),c=n(c,a,r,l,t[13],12,-40341101),l=n(l,c,a,r,t[14],17,-1502002290),r=n(r,l,c,a,t[15],22,1236535329),a=i(a,r,l,c,t[1],5,-165796510),c=i(c,a,r,l,t[6],9,-1069501632),l=i(l,c,a,r,t[11],14,643717713),r=i(r,l,c,a,t[0],20,-373897302),a=i(a,r,l,c,t[5],5,-701558691),c=i(c,a,r,l,t[10],9,38016083),l=i(l,c,a,r,t[15],14,-660478335),r=i(r,l,c,a,t[4],20,-405537848),a=i(a,r,l,c,t[9],5,568446438),c=i(c,a,r,l,t[14],9,-1019803690),l=i(l,c,a,r,t[3],14,-187363961),r=i(r,l,c,a,t[8],20,1163531501),a=i(a,r,l,c,t[13],5,-1444681467),c=i(c,a,r,l,t[2],9,-51403784),l=i(l,c,a,r,t[7],14,1735328473),r=i(r,l,c,a,t[12],20,-1926607734),a=s(a,r,l,c,t[5],4,-378558),c=s(c,a,r,l,t[8],11,-2022574463),l=s(l,c,a,r,t[11],16,1839030562),r=s(r,l,c,a,t[14],23,-35309556),a=s(a,r,l,c,t[1],4,-1530992060),c=s(c,a,r,l,t[4],11,1272893353),l=s(l,c,a,r,t[7],16,-155497632),r=s(r,l,c,a,t[10],23,-1094730640),a=s(a,r,l,c,t[13],4,681279174),c=s(c,a,r,l,t[0],11,-358537222),l=s(l,c,a,r,t[3],16,-722521979),r=s(r,l,c,a,t[6],23,76029189),a=s(a,r,l,c,t[9],4,-640364487),c=s(c,a,r,l,t[12],11,-421815835),l=s(l,c,a,r,t[15],16,530742520),r=s(r,l,c,a,t[2],23,-995338651),a=o(a,r,l,c,t[0],6,-198630844),c=o(c,a,r,l,t[7],10,1126891415),l=o(l,c,a,r,t[14],15,-1416354905),r=o(r,l,c,a,t[5],21,-57434055),a=o(a,r,l,c,t[12],6,1700485571),c=o(c,a,r,l,t[3],10,-1894986606),l=o(l,c,a,r,t[10],15,-1051523),r=o(r,l,c,a,t[1],21,-2054922799),a=o(a,r,l,c,t[8],6,1873313359),c=o(c,a,r,l,t[15],10,-30611744),l=o(l,c,a,r,t[6],15,-1560198380),r=o(r,l,c,a,t[13],21,1309151649),a=o(a,r,l,c,t[4],6,-145523070),c=o(c,a,r,l,t[11],10,-1120210379),l=o(l,c,a,r,t[2],15,718787259),r=o(r,l,c,a,t[9],21,-343485551),e[0]=u(a,e[0]),e[1]=u(r,e[1]),e[2]=u(l,e[2]),e[3]=u(c,e[3])},t=function(e,t,n,i,s,o){return t=u(u(t,e),u(i,o)),u(t<<s|t>>>32-s,n)},n=function(e,n,i,s,o,a,r){return t(n&i|~n&s,e,n,o,a,r)},i=function(e,n,i,s,o,a,r){return t(n&s|i&~s,e,n,o,a,r)},s=function(e,n,i,s,o,a,r){return t(n^i^s,e,n,o,a,r)},o=function(e,n,i,s,o,a,r){return t(i^(n|~s),e,n,o,a,r)},a=function(t){txt="";var n,i=t.length,s=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=t.length;n+=64)e(s,r(t.substring(n-64,n)));t=t.substring(n-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<t.length;n++)o[n>>2]|=t.charCodeAt(n)<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(e(s,o),n=0;16>n;n++)o[n]=0;return o[14]=8*i,e(s,o),s},r=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n},l="0123456789abcdef".split(""),c=function(e){for(var t="",n=0;4>n;n++)t+=l[e>>8*n+4&15]+l[e>>8*n&15];return t},d=function(e){for(var t=0;t<e.length;t++)e[t]=c(e[t]);return e.join("")};window.md5=function(e){return d(a(e))};var u=function(e,t){return e+t&4294967295};if("5d41402abc4b2a76b9719d911017c592"!=md5("hello"))var u=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}}(),function(e,t){"use strict";var n="",i="?",s="function",o="undefined",a="object",r="major",l="model",c="name",d="type",u="vendor",p="version",f="architecture",h="console",g="mobile",m="tablet",v={has:function(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},$={rgx:function(){for(var e,n,i,r,l,c,d,u=0,p=arguments;u<p.length;u+=2){var f=p[u],h=p[u+1];if(typeof e===o){e={};for(r in h)l=h[r],typeof l===a?e[l[0]]=t:e[l]=t}for(n=i=0;n<f.length;n++)if(c=f[n].exec(this.getUA())){for(r=0;r<h.length;r++)d=c[++i],l=h[r],typeof l===a&&l.length>0?2==l.length?e[l[0]]=typeof l[1]==s?l[1].call(this,d):l[1]:3==l.length?e[l[0]]=typeof l[1]!==s||l[1].exec&&l[1].test?d?d.replace(l[1],l[2]):t:d?l[1].call(this,d,l[2]):t:4==l.length&&(e[l[0]]=d?l[3].call(this,d.replace(l[1],l[2])):t):e[l]=d?d:t;break}if(c)break}return e},str:function(e,n){for(var s in n)if(typeof n[s]===a&&n[s].length>0){for(var o=0;o<n[s].length;o++)if(v.has(n[s][o],e))return s===i?t:s}else if(v.has(n[s],e))return s===i?t:s;return e}},b={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},w={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[c,p,r],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[c,"Opera"],p,r],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[c,p,r],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[c,"IE"],p,r],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[c,"Yandex"],p,r],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[c,/_/g," "],p,r],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[c,p,r],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[c,"Dolphin"],p,r],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[c,"Chrome"],p,r],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[p,r,[c,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[p,r,c],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[c,[r,$.str,b.browser.oldsafari.major],[p,$.str,b.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[c,p,r],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[c,"Netscape"],p,r],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[c,p,r]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[f,/ower/,"",v.lowerize]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[f,v.lowerize]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[l,u,[d,m]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,l,[d,m]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,u,[d,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,l,[d,g]],[/\((bb10);\s(\w+)/i],[[u,"BlackBerry"],l,[d,g]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+))/i],[[u,"Asus"],l,[d,m]],[/(sony)\s(tablet\s[ps])/i],[u,l,[d,m]],[/(nintendo)\s([wids3u]+)/i],[u,l,[d,h]],[/((playstation)\s[3portablevi]+)/i],[[u,"Sony"],l,[d,h]],[/(sprint\s(\w+))/i],[[u,$.str,b.device.sprint.vendor],[l,$.str,b.device.sprint.model],[d,g]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[u,[l,/_/g," "],[d,g]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[u,"Motorola"],l,[d,g]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[u,"Motorola"],l,[d,m]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9))/i],[[u,"Samsung"],l,[d,m]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[u,"Samsung"],l,[d,g]],[/(sie)-(\w+)*/i],[[u,"Siemens"],l,[d,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[u,"Nokia"],l,[d,g]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[u,"Acer"],l,[d,m]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],l,[d,m]],[/((nexus\s4))/i,/((nexus\s5))/i,/(lg)[e;\s-\/]+(\w+)*/i],[[u,"LG"],l,[d,g]],[/(mobile|tablet);.+rv\:.+gecko\//i],[d,u,l]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[c,p],[/rv\:([\w\.]+).*(gecko)/i],[p,c]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[c,[p,$.str,b.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[c,"Windows"],[p,$.str,b.os.windows.version]],[/\((bb)(10);/i],[[c,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[c,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[c,"Symbian"],p],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[c,"Firefox OS"],p],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[c,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[c,"Chromium OS"],p],[/(sunos)\s?([\w\.]+\d)*/i],[[c,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[c,p],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[c,"iOS"],[p,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[c,[p,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[c,p]]},y=function(t){var i=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:n);return this instanceof y?(this.getBrowser=function(){return $.rgx.apply(this,w.browser)},this.getCPU=function(){return $.rgx.apply(this,w.cpu)},this.getDevice=function(){return $.rgx.apply(this,w.device)},this.getEngine=function(){return $.rgx.apply(this,w.engine)},this.getOS=function(){return $.rgx.apply(this,w.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},void this.setUA(i)):new y(t).getResult()};if(typeof exports!==o)typeof module!==o&&module.exports&&(exports=module.exports=y),exports.UAParser=y;else if(e.UAParser=y,typeof define===s&&define.amd&&define(function(){return y}),typeof e.jQuery!==o){var k=e.jQuery,x=new y;k.ua=x.getResult(),k.ua.get=function(){return x.getUA()},k.ua.set=function(e){x.setUA(e);var t=x.getResult();for(var n in t)k.ua[n]=t[n]}}}(this);var Chromecast=function(){"use strict";function e(){var e=new chrome.cast.SessionRequest(f),o=new chrome.cast.ApiConfig(e,s,i);chrome.cast.initialize(o,t,n)}function t(){console.log("Google Cast init success")}function n(){console.log("Google Cast init error")}function i(e){e===chrome.cast.ReceiverAvailability.AVAILABLE?(console.log("Receiver available"),b.forEach(function(e){e(1)})):(console.log("No receivers available"),b.forEach(function(e){e(0)}))}function s(e){console.log("Session found"),g=e,$.forEach(function(e){e()}),0!==g.media.length&&a("onRequestSessionSuccess",g.media[0])}function o(e){console.log("onMediaError"+JSON.stringify(e))}function a(e,t){console.log("onMediaDiscovered"),m=t,p(),"onRequestSessionSuccess"!==e&&v.forEach(function(e){e()})}function r(e){console.log("onLaunchError called: "+JSON.stringify(e))}function l(e){console.log("session request success"),g=e,$.forEach(function(e){e()}),y&&u(y.url,y.data)}function c(){console.log("Session stop success")}function d(){console.log("Session stop error")}function u(e,t){var n=new chrome.cast.media.MediaInfo(e);n.contentType="video/mp4",n.metadata=t;var i=new chrome.cast.media.LoadRequest(n);g.loadMedia(i,a.bind(this,"loadMedia"),o)}function p(){w.forEach(function(e){m&&e(m.getEstimatedTime())}),k=setTimeout(function(){p()},100)}var f,h=!1,g=null,m=null,v=[],$=[],b=[],w=[],y=null;window.__onGCastApiAvailable=function(t,n){t?(h=!0,console.log("Google Cast loaded"),f&&e()):console.log(n)};var k;return{init:function(t){f=t,h&&e()},start:function(){chrome.cast.requestSession(l,r)},stop:function(){g&&(clearTimeout(k),g.stop(c,d),g=null)},session:function(e){$.push(e)},receiver:function(e){b.push(e)},running:function(){return null!==g},load:function(e,t){g?u(e,t):(y={url:e,data:t},console.log("Loading media after session is available if needed"))},mediaLoaded:function(e){v.push(e)},play:function(){m&&m.play(new chrome.cast.media.PlayRequest,null,null)},pause:function(){m&&m.pause(new chrome.cast.media.PauseRequest,null,null)},seek:function(e){if(m){var t=new chrome.cast.media.SeekRequest;t.currentTime=e,m.seek(t,null,null)}},mute:function(e){if(m){var t=new chrome.cast.media.VolumeRequest(new chrome.cast.Volume(null,e));m.setVolume(t,null,null)}},volume:function(e){if(m){var t=new chrome.cast.media.VolumeRequest(new chrome.cast.Volume(e,null));m.setVolume(t,null,null)}},timeUpdate:function(e){w.push(e)},receiverName:function(){return g.receiver.friendlyName}}}(),DragDrop=function(){function e(e){var t;return $(n+":not(.dragging)").each(function(n,i){Math.abs($(i).offset().top+c-e)<c&&(t=$(i))}),t}var t,n,i,s,o,a,r,l,c,d,u=[];return{init:function(p,f){t=p,n=f,$(t).on("mousedown",n,function(e){e.stopPropagation(),i=$(this),c=i.outerHeight()/2,l=e.pageY,d=l,a=e.pageX-i.offset().left,r=e.pageY-i.offset().top}),$(document).mousemove(function(t){if(t.pageY!==l){if(i&&!s){i.hasClass("label")&&i.find(".content").hide(),s=!0;var n=i.width(),a=i.outerHeight();i.replaceWith('<div class="dragging-placeholder"></div>'),$(".dragging-placeholder").height(a),i.addClass("dragging").width(n),i.css("left",i.offset().left),i.css("top",i.offset().top),i.detach().appendTo("body")}if(i){i.css("left","50px"),i.css("top",t.pageY-r);var a=i.outerHeight();o=e(t.pageY-r+c),void 0!==o&&($(".dragging-placeholder").remove(),d<t.pageY?o.hasClass("label")?o.find(".content").prepend($('<div class="dragging-placeholder"></div>')):$('<div class="dragging-placeholder"></div>').insertAfter(o):$('<div class="dragging-placeholder"></div>').insertBefore(o),$(".dragging-placeholder").height(a)),d=t.pageY}}}),$(document).mouseup(function(){i&&(s&&(i.css("left","auto"),i.css("top","auto"),i.removeClass("dragging"),$(".dragging-placeholder").replaceWith(i),s=!1,u.forEach(function(e){e()})),i=null)})},ended:function(e){u.push(e)}}}();!function(){"use strict";function e(e){$.post(nt+"library/casts",{feedurl:e},function(){Bt=!0,h()}),$("#input-vmenu-add").val(""),$("#input-vmenu-add").toggle(),$("#button-vmenu-add").toggle(),$("#vmenu-add-results").toggle()}function t(e){$("#input-vmenu-label").val(""),$("#input-vmenu-label").toggle(),$("#button-vmenu-label").toggle(),$.post(nt+"library/labels",{name:e},function(){T()})}function n(e){D(e);var t=K(e);t?($("#pretty img").prop("src",t),$("#pretty").show(),$(".pretty-button").css("line-height",$("#pretty img").height()+"px"),$("#pretty img").css("max-height",.4*$("#main-container").height()+"px")):$("#pretty").hide(),St=e;var n=e in vt?vt[e]:$t[e];$("#episode-title, #overlay-info h2").html(n.feed.title),$("#episode-date").html(new Date(n.feed.pubDate).toLocaleString()),$("#episode-desc").html(n.feed.description),$("#episode-desc *").removeAttr("style"),$("#overlay-info h5").html(bt[n.castid].feed.title),$("#episode-bar").show(),setTimeout(function(){pt.refresh()},0),L()}function i(e){St=e,n(e),sessionStorage.selectedepisode=e,$("#episode-bar-play").html(xt===e?Lt?"Play":"Pause":"Play"),$(".episode").removeClass("selected"),$("#ep-"+e).addClass("selected")}function s(e){if(xt!==e&&(null!==xt&&(W("vid").paused||c(Nt.Play)),!(e in vt)&&e in $t&&(vt[e]=$t[e],delete $t[e],it.put("episodes",vt)),e in vt)){sessionStorage.lastepisode=JSON.stringify({id:e,castid:vt[e].castid}),n(e),xt=e,null===vt[e].lastevent&&c(Nt.Start,e,0);var t="";_.isString(vt[e].feed.description)&&(t=vt[e].feed.description.replace(/(<([^>]+)>)/gi,"")),Chromecast.load(vt[e].feed.enclosure.url,{title:vt[e].feed.title,description:t,image:K(e)});var i=W("vid");i.setAttribute("src",vt[e].feed.enclosure.url),i.load(),Tt=!0,Ut=!1,i.playbackRate=Ot.Playback.PlaybackRate.value,e=vt[e].castid,jt=[];for(var s in vt)vt[s].castid==e&&(vt[s].lastevent&&vt[s].lastevent.type==Nt.Delete||(jt.push(vt[s]),s==xt&&(It=jt.length-1)));jt.sort(function(e,t){var n=new Date(e.feed.pubDate),i=new Date(t.feed.pubDate);return n>i?-1:i>n?1:0}),$("#vid-container").removeClass("minimized")}}function o(e){if(e in vt){$("#ep-"+e).remove(),c(Nt.Delete,e);var t=$("#cast-"+vt[e].castid+" .n");t.html(t.html()-1),delete vt[ct],it.put("episodes",vt)}}function a(){et=$("#input-username").val(),nt=$("#input-target").val(),-1===nt.indexOf("/",nt.length-1)&&(nt+="/");var e=localStorage.uuid||Y();$.post(nt+"account/login",{username:et,password:$("#input-password").val(),clientname:"Castcloud",clientdescription:Q(),clientversion:"0.1",uuid:e},function(t){Z=t.token,void 0!==Z&&(localStorage.token=Z,localStorage.username=et,localStorage.uuid=e,localStorage[V("apiTarget")]=nt,r(),$("#tab-podcasts").fadeIn("fast"),$("#playbar").slideDown("fast"),$("#topbar nav").fadeIn("fast"),$("#userinfo").fadeIn("fast"))}),$("#input-password").val("")}function r(){gt=!0,$("#userinfo span").html(et),$(".tab").hide(),$("#main-container").css("bottom","55px"),"now-playing"!==Backbone.history.fragment&&$("#vid-container").addClass("thumb");var e=_.after(4,function(){p();var e=_.template($("script.labels").html());$("#add-to-label").empty().append(e({labels:st}))}),t=_.after(2,function(){wt.forEach(function(e){e.episodeid in vt&&(!vt[e.episodeid].lastevent||e.clientts>vt[e.episodeid].lastevent.clientts)&&(vt[e.episodeid].lastevent=e)})});it=new IDBStore({storeName:V("db"),keyPath:null},function(){mt=!0,console.log("IDB ready"),it.get("labels",function(t){t&&(console.log("Labels loaded from IDB"),st=t,e())}),it.get("casts",function(t){t&&(console.log("Casts loaded from IDB"),bt=t,e())}),it.get("episodes",function(n){n&&(console.log("Episodes loaded from IDB"),vt=n,t(),e())}),it.get("events",function(n){if(n){if(console.log("Events loaded from IDB"),wt=n,"popout"!==window.name){if(localStorage.beforeunloadevent){var i=JSON.parse(localStorage.beforeunloadevent);console.log("pushing beforeunloadevent"),c(i.type,i.id,i.time),localStorage.removeItem("beforeunloadevent")}if(localStorage.unloadevent){var i=JSON.parse(localStorage.unloadevent);console.log("pushing unloadevent"),c(i.type,i.id,i.time),localStorage.removeItem("unloadevent")}}t(),e()}}),it.get("settings",function(e){e&&(console.log("Settings loaded from IDB"),Ot=$.extend(!0,{},Dt,e),$(".thumb").width(Ot.__client.ThumbWidth.value),C(),w())}),it.get("buffer_events",function(e){e&&(At.events=e)}),it.get("buffer_settings",function(e){e&&(At.settings=e)});for(var n in At.idb)it.put(n,At.idb[n]),console.log("Flushed "+n+" from IDB buffer")}),$.ajaxSetup({headers:{Authorization:Z}}),l()}function l(e){T(),h(),E(),b(),At.events.length>0&&d(),_.size(At.settings)>0&&k(),e||setTimeout(l,1e3*Ot.Advanced.SyncInterval.value)}function c(e,t,n){if(!at){var i=X();qt===i?Mt++:Mt=0,qt=i,t=t||xt,At.events.push({type:e,episodeid:t,positionts:void 0===n?0|W("vid").currentTime:n,concurrentorder:Mt,clientts:i}),it.put("buffer_events",At.events),d(),t in vt&&(vt[t].lastevent={type:e,positionts:void 0===n?0|W("vid").currentTime:n,clientts:i,clientname:null,clientdescription:null});var s={clientdescription:"Best",clientname:"Castcloud",clientts:i,episodeid:t,name:Nt[e],positionts:void 0===n?0|W("vid").currentTime:n,type:e},o=new Date(1e3*s.positionts);o.setHours(o.getHours()-1),s.position="",o.getHours()>0&&(s.position+=o.getHours()+"h "),s.position+=o.getMinutes()+"m "+o.getSeconds()+"s";var a=new Date(1e3*s.clientts);a.setHours(a.getHours()-1),s.date=a.toLocaleString(),wt.unshift(s),it.put("events",wt),t==St&&D(t)}}function d(){$.post(nt+"library/events",{json:JSON.stringify(At.events)},function(){At.events=[],it.remove("buffer_events")})}function u(e){var t=nt+(void 0===e?"library/casts":"library/casts/"+e);$.ajax(t,{headers:{"If-None-Match":localStorage.etag_casts},type:"GET",success:function(e,t,n){if(200===n.status){var i=n.getResponseHeader("etag");i&&(localStorage.etag_casts=i),e.forEach(function(e){bt[e.id]=e}),mt?it.put("casts",bt):At.idb.casts=bt,p()}}})}function p(){var e="";if(zt||(e=md5(JSON.stringify(st)+JSON.stringify(bt))),e!==Ht){Ht=e;var t=_.template($("script.podcasts").html());if($("#podcasts").empty().append(t({labels:st,casts:bt})),L(),st.root.forEach(function(e){"label"===e.type&&st[e.id].expanded&&$("#label-"+e.id+" .content").show()}),dt?setTimeout(function(){dt.refresh()},0):dt=new IScroll("#foo",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0}),sessionStorage.selectedcast)null===Ct&&g(sessionStorage.selectedcast),Ct=sessionStorage.selectedcast,$("#cast-"+sessionStorage.selectedcast).addClass("selected");else if(sessionStorage.lastepisode){var n=JSON.parse(sessionStorage.lastepisode);g(n.castid)}var i={};for(var s in vt){var o=vt[s];o.castid in i?i[o.castid]++:i[o.castid]=1}for(var a in i)$("#cast-"+a+" .n").html(i[a]);$(".cast .n").each(function(e,t){$(t).html().length<1&&$(t).width(0)}),Bt&&(Bt=!1,f($("#podcasts > .cast:last-child").id()),setTimeout(function(){dt.scrollTo(0,dt.maxScrollY,0)},0)),zt&&(zt=!1,setTimeout(function(){Ht=md5(JSON.stringify(st)+JSON.stringify(bt))},0))}}function f(e){Ct=e,g(e),$(".cast").removeClass("selected"),$("#cast-"+e).addClass("selected"),sessionStorage.selectedcast=e}function h(){localStorage[V("since")]||(localStorage[V("since")]=0),console.log("fetching episodes since "+localStorage[V("since")]),$.get(nt+"library/newepisodes",{since:localStorage[V("since")]},function(e){localStorage[V("since")]=e.timestamp,console.log(e.episodes.length+" episodes fetched"),e.episodes.length>0&&(it.get("episodes",function(t){t=t||{},e.episodes.forEach(function(e){t[e.id]=e}),it.put("episodes",t)}),e.episodes.forEach(function(e){vt[e.id]=e,Ct==e.castid&&$("#episodes").prepend('<div id="ep-'+e.id+'" class="episode">'+e.feed.title+'<div class="delete">Delete</div></div>')}),Ct==e.episodes[0].castid&&setTimeout(function(){ut.refresh()},0),Bt&&T())})}function g(e){var t=[];for(var i in vt)vt[i].castid==e&&(vt[i].lastevent&&vt[i].lastevent.type==Nt.Delete||t.push(vt[i]));if(t.length>0){t.sort(function(e,t){var n=new Date(e.feed.pubDate),i=new Date(t.feed.pubDate);return n>i?-1:i>n?1:0});var o=_.template($("script.episodes").html());if($("#episodes").empty().append(o({episodes:t})),U(),sessionStorage.lastepisode){var a=JSON.parse(sessionStorage.lastepisode);a.id in vt&&s(a.id),$("#ep-"+a.id).addClass("selected")}else sessionStorage.selectedepisode&&(n(sessionStorage.selectedepisode),$("#ep-"+sessionStorage.selectedepisode).addClass("selected"))}else $("#episodes").empty().append('<div class="episodes-empty"><h2>There are no episodes left</h2><button id="show-all-episodes" class="button">Show me everything!</button></div>');ut?setTimeout(function(){ut.refresh()},0):ut=new IScroll("#foo2",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0})}function m(e){$.get(nt+"library/episodes/"+e,function(e){$t={},e.forEach(function(e){$t[e.id]=e});var t=_.template($("script.episodes").html());$("#episodes").empty().append(t({episodes:e})),ut?setTimeout(function(){ut.refresh()},0):ut=new IScroll("#foo2",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0}),U()})}function v(e){if(e===xt)H(0);else{!(e in vt)&&e in $t&&(vt[e]=$t[e],delete $t[e],it.put("episodes",vt)),c(Nt.Pause,e,0),U();var t=$("#cast-"+vt[e].castid+" .n");t.html(parseInt(t.html())+1)}}function b(){var e=nt+"account/settings";$.ajax(e,{headers:{"If-None-Match":localStorage.etag_settings},type:"GET",success:function(e,t,n){if(200===n.status){var i=n.getResponseHeader("etag");i&&(localStorage.etag_settings=i),Ot={},e.forEach(function(e){var t=e.setting.split("/")[0],n=e.setting.split("/")[1];void 0===n&&(n=t,t="General"),void 0===Ot[t]&&(Ot[t]={}),Ot[t][n]={value:e.value,clientspecific:e.clientspecific}}),Ot=$.extend(!0,{},Dt,Ot),C(),w(),mt?it.put("settings",Ot):At.idb.settings=Ot}}})}function w(e){var t="";if(void 0!==e||Kt||(t=md5(JSON.stringify(Ot))),e||t!==Rt){Rt=t,$("#settings-menu").empty(),$("#settings-panel").empty();for(var n in Ot){$("#settings-menu").append('<p class="setting-button" id="setting-'+n+'">'+n+"</p>");var i=$('<div class="setting-panel" id="setting-panel-'+n+'"><h2>'+n+"</h2></div>");"General"===n&&(i.append('<h3>OPML</h3><p><button class="button" id="import-opml">Import</button><input type="file" id="hax" style="display:none"><button class="button" id="opml">Export</button></p><h3>Local data<span class="used"></span></h3><button class="button" id="clear-local-data">Clear</button><h3>Default settings</h3><button class="button" id="reset-settings">Reset</button>'),S());for(var s in Ot[n]){var o=n+"_"+s,a=Ot[n][s];a.type===_t.Keybind?i.append("<p><label>"+s+'</label><input type="text" id="'+o+'" class="setting keybind" value="'+a.value+'"></p>'):a.type===_t.Bool?(i.append("<p><label>"+s+'</label><input type="checkbox" id="'+o+'" class="setting"></p>'),i.find("#"+o).prop("checked","true"==String(a.value))):i.append("<p><label>"+s+'</label><input type="text" id="'+o+'" class="setting" value="'+a.value+'"></p>')}$("#settings-panel").append(i)}$("#setting-General").addClass("selected"),$("#setting-panel-General").show(),Kt&&(Kt=!1,setTimeout(function(){Rt=md5(JSON.stringify(Ot))},0))}}function y(e,t,n){n=n||"General",Ot[n][e].value=t,Rt=md5(JSON.stringify(Ot)),At.settings.push({setting:n+"/"+e,value:t,clientspecific:Ot[n][e].clientspecific}),it.put("buffer_settings",At.settings),k(),it.put("settings",Ot),"Keybinds"===n&&C()}function k(){$.post(nt+"account/settings",{json:JSON.stringify(At.settings)},function(){At.settings=[],it.remove("buffer_settings")})}function x(){Ot=Dt;for(var e in Ot)for(var t in Ot[e])At.settings.push({setting:e+"/"+t,value:Ot[e][t].value,clientspecific:Ot[e][t].clientspecific});it.put("buffer_settings",At.settings),k(),it.put("settings",Ot),w(!0),C()}function S(){navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota(function(e){$(".used").html((e/1024/1024).toFixed(2)+" MB")})}function C(){Mousetrap.reset(),Mousetrap.bind(Ot.Keybinds.PlayPause.value,O),Mousetrap.bind(Ot.Keybinds.Next.value,q),Mousetrap.bind(Ot.Keybinds.Previous.value,M),Mousetrap.bind(Ot.Keybinds.SkipForward.value,B),Mousetrap.bind(Ot.Keybinds.SkipBack.value,R)}function T(){var e=nt+"library/labels";$.ajax(e,{type:"GET",headers:{},success:function(e,t,n){if(200===n.status){var i=n.getResponseHeader("etag");i&&(localStorage.etag_labels=i),st={},e.forEach(function(e){"root"===e.name&&(ot=e.id),st[e.name]=[],e.content&&e.content.split(",").forEach(function(t){var n=t.split("/");st[e.name].push({type:n[0],id:parseInt(n[1])})}),st[e.id]={name:e.name,expanded:e.expanded}});var s=_.template($("script.labels").html());$("#add-to-label").empty().append(s({labels:st})),mt?it.put("labels",st):At.idb.labels=st,u()}},error:function(){u()}})}function P(){var e=[];$("#podcasts > div").each(function(t,n){e.push($(n).prop("id").replace("-","/"))}),$.ajax(nt+"library/labels/"+ot,{type:"PUT",data:{content:e.join()}}),$("#podcasts .label").each(function(t,n){e=[],$(n).find(".cast").each(function(t,n){e.push($(n).prop("id").replace("-","/"))}),$.ajax(nt+"library/labels/"+$(n).id(),{type:"PUT",data:{content:e.join(),expanded:$(n).find(".content").is(":visible")}})})}function E(){localStorage[V("since-events")]||(localStorage[V("since-events")]=0),console.log("fetching events since "+localStorage[V("since-events")]),$.get(nt+"library/events",{since:localStorage[V("since-events")],exclude_self:!0},function(e){localStorage[V("since-events")]=e.timestamp,e.events.forEach(function(e){var t=new Date(1e3*e.positionts);t.setHours(t.getHours()-1),e.position="",t.getHours()>0&&(e.position+=t.getHours()+"h "),e.position+=t.getMinutes()+"m "+t.getSeconds()+"s";var n=new Date(1e3*e.clientts);n.setHours(n.getHours()-1),e.date=n.toLocaleString(),e.name=Nt[e.type],e.episodeid in vt&&(!vt[e.episodeid].lastevent||e.clientts>vt[e.episodeid].lastevent.clientts)&&(vt[e.episodeid].lastevent=e),wt.unshift(e)}),e.events.length>0&&(wt.sort(function(e,t){return e.clientts>t.clientts?-1:e.clientts<t.clientts?1:e.concurrentorder>t.concurrentorder?-1:e.concurrentorder<t.concurrentorder?1:0}),mt?it.put("events",wt):At.idb.events=wt,null!==St&&D(St)),console.log(e.events.length+" events fetched")})}function D(e){for(var t=[],n=0;n<wt.length&&(wt[n].episodeid!=e||(t.push(wt[n]),10!==t.length));n++);var i=_.template($("script.events").html());$("#events").empty().append(i({events:t}))}function O(){Lt?N():A(),at&&F({action:"playPause"})}function N(){Chromecast.running()?Chromecast.play():W("vid").play(),Ut=!1,Lt=!1,c(Nt.Play),$(".button-play i").addClass("fa-pause"),$(".button-play i").removeClass("fa-play"),U(),$("#episode-bar-play").html("Pause"),$(".pretty-overlay").hide()}function A(){Chromecast.running()?Chromecast.pause():W("vid").pause(),Lt=!0,c(Nt.Pause),$(".button-play i").addClass("fa-play"),$(".button-play i").removeClass("fa-pause"),U(),$("#episode-bar-play").html("Play"),$(".pretty-overlay").show()}function H(e){at?F({action:"seek",time:e}):Chromecast.running()?Chromecast.seek(e):W("vid").currentTime=e;var t=1/ht*e;$("#seekbar div").css("width",$("#seekbar").width()*t+"px"),$("#badeball").css("left",$("#seekbar").width()*t-10+"px")}function R(){if(at)F({action:"skipBack"});else{Chromecast.running()&&(lt-=15,Chromecast.seek(lt));var e=W("vid");c(Nt.Pause),e.currentTime=e.currentTime-15,c(Nt.Play),e.paused&&c(Nt.Pause)}}function B(){if(at)F({action:"skipForward"});else{Chromecast.running()&&(lt+=15,Chromecast.seek(lt));var e=W("vid");c(Nt.Pause),e.currentTime=e.currentTime+15,c(Nt.Play),e.paused&&c(Nt.Pause)}}function I(){at&&F({action:"muteToggle"});var e=W("vid");e.muted=!e.muted,Chromecast.mute(e.muted),e.muted?($("#volume i").removeClass("fa-volume-up"),$("#volume i").addClass("fa-volume-off"),$("#volume .bar .inner").css("width",0)):($("#volume i").removeClass("fa-volume-off"),$("#volume i").addClass("fa-volume-up"),$("#volume .bar .inner").css("width",60*e.volume+"px"))}function j(e){0>e?e=0:e>1&&(e=1),at&&F({action:"volume",volume:e}),Chromecast.volume(e);var t=W("vid");t.volume=e,$("#volume .bar .inner").css("width",60*t.volume+"px"),0===e?($("#volume i").removeClass("fa-volume-up"),$("#volume i").addClass("fa-volume-off")):(t.muted=!1,$("#volume i").removeClass("fa-volume-off"),$("#volume i").addClass("fa-volume-up"))}function q(){"true"==String(Ot.Playback.KeepPlaying.value)&&(It++,It<jt.length&&(kt=!0,s(jt[It].id)))}function M(){console.log("previousEpisode called")}function z(){var e=W("vid-container");$("#vid-container").hasClass("fs")?(document.webkitExitFullscreen(),$("#playbar-fullscreen").removeClass("fa-compress").addClass("fa-expand")):(e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),$("#playbar-fullscreen").removeClass("fa-expand").addClass("fa-compress"))
}function K(e){var t=e in vt?vt[e]:$t[e],n=bt[t.castid];return t.feed["media:thumbnail"]?t.feed["media:thumbnail"].url:t.feed["itunes:image"]?t.feed["itunes:image"].href:n.feed["itunes:image"]?n.feed["itunes:image"].href:n.feed.image?n.feed.image.url:null}function L(){$("#episodeinfo").isOverflowing()?$("#vid-container.thumb").css("right","15px"):$("#vid-container.thumb").css("right","1px")}function U(){$(".episode i").remove(),$(".episode").each(function(e,t){var n=$(t).id(),i=n in vt?vt[n]:$t[n];n!==xt||Ut?null!==i.lastevent&&(i.lastevent.type>=Nt.EndOfTrack?$("#ep-"+n).append('<i class="fa fa-circle progress"></i>'):i.lastevent.positionts>0&&$("#ep-"+n).append('<i class="fa fa-circle-o progress"></i>')):$("#ep-"+n).append(Tt?'<i class="fa fa-spinner fa-spin"></i>':Lt?'<i class="fa fa-pause"></i>':'<i class="fa fa-play"></i>')})}function F(e){at.postMessage(JSON.stringify(e),"*")}function J(){$("#cast-overlay").css("line-height",$("#cast-overlay").height()+"px")}function G(e,t,n){ct=$(t).id(),$(e).css("left",n.pageX+"px"),$(e).css("top",n.pageY+"px"),$(".context-menu").hide(),$(e).show(),n.preventDefault()}function W(e){return $("#"+e).get(0)}function X(){return $.now()/1e3|0}function Y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function V(e){return et+"-"+e}function Q(){var e=(new UAParser).getResult(),t=e.browser.name?e.browser.name+", ":"";return t+=e.os.name?e.os.name+" "+e.os.version+", ":"",t+=e.device.vendor?e.device.vendor+" "+e.device.model:"",-1!==t.indexOf(" ",t.length-1)&&(t=t.substr(0,t.length-2)),t}var Z,et,tt,nt,it,st,ot,at,rt,lt,ct,dt,ut,pt,ft,ht,gt=!1,mt=!1,vt={},$t={},bt={},wt=[],yt=!1,kt=!1,xt=null,St=null,Ct=null,Tt=!1,Pt=null,Et=null,_t={Text:0,Bool:1,Keybind:2},Dt={General:{},Playback:{KeepPlaying:{type:_t.Bool,value:!0},PlaybackRate:{type:_t.Text,value:1}},Keybinds:{PlayPause:{type:_t.Keybind,value:"space"},Next:{type:_t.Keybind,value:"pageup"},Previous:{type:_t.Keybind,value:"pagedown"},SkipForward:{type:_t.Keybind,value:"right"},SkipBack:{type:_t.Keybind,value:"left"}},Advanced:{SyncInterval:{type:_t.Text,value:10}},__client:{ThumbWidth:{value:200,clientspecific:!0}}},Ot=Dt,Nt={Start:10,Pause:20,Play:30,SleepStart:40,SleepEnd:50,EndOfTrack:60,Delete:70,10:"Start",20:"Pause",30:"Play",40:"Sleep Started",50:"Sleep Ended",60:"End Of Track",70:"Delete"},At={events:[],settings:[],idb:{}};Chromecast.init("3EC703A8"),Chromecast.session(function(){$(".cc img").prop("src","img/cast_on.png"),W("vid").pause(),$("#cast-overlay").show(),J()}),Chromecast.receiver(function(e){e>0?$(".cc").show():$(".cc").hide()}),Chromecast.mediaLoaded(function(){Chromecast.seek(W("vid").currentTime),Lt&&Chromecast.pause()}),$(document).ready(function(){function n(e){var t=new Date(1e3*e),n=new Date(1e3*ht),i=1/ht*e;t.setHours(t.getHours()-1),n.setHours(n.getHours()-1);var s="";if(t.getHours()>0&&(s+=t.getHours().pad()+":"),s+=t.getMinutes().pad()+":"+t.getSeconds().pad()+"/",n.getHours()>0&&(s+=n.getHours().pad()+":"),s+=n.getMinutes().pad()+":"+n.getSeconds().pad(),"popout"===window.name&&e>0){var o=new window.Event("timeupdate");o.data={time:e},window.dispatchEvent(o)}$("#time").html(s),$("#seekbar").is(":visible")&&($("#seekbar div").css("width",$("#seekbar").width()*i+"px"),$("#badeball").css("left",$("#seekbar").width()*i-10+"px"))}function d(e){var t=1/$("#seekbar").width()*(e-$("#seekbar").position().left)*ht,n=new Date(1e3*t);n.setHours(n.getHours()-1);var i="";n.getHours()>0&&(i+=n.getHours().pad()+":"),i+=n.getMinutes().pad()+":"+n.getSeconds().pad(),$("#seektime").css("left",e-$("#seektime").outerWidth()/2+"px"),$("#seektime").html(i)}var u=Backbone.Router.extend({routes:{"":"podcasts",podcasts:"podcasts",episodes:"episodes",settings:"settings","now-playing":"nowPlaying",fullscreen:"fullscreen","p:n":"foo","*any":"podcasts"},podcasts:function(){$(".tab").hide(),gt?($("#tab-podcasts").show(),dt&&setTimeout(function(){dt.refresh(),ut.refresh()},0),b&&(g=0,$(".col").hide(),$("#playbar").show(),$(".col:eq(0)").show()),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},episodes:function(){$(".tab").hide(),gt?($("#tab-episodes").show(),ut&&setTimeout(function(){ft.refresh()},0),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},settings:function(){$(".tab").hide(),gt?($("#tab-settings").show(),S(),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},foo:function(e){$(".tab").hide(),gt?($("#tab-podcasts").show(),dt&&setTimeout(function(){dt.refresh(),ut.refresh()},0),g=e,b&&($(".col").hide(),$("#playbar").show(),$(".col:eq("+e+")").show(),2==g?($("#podcast-vmenu").hide(),$("#podcast-cols").css("left","0px")):($("#podcast-vmenu").show(),$("#podcast-cols").css("left","50px"))),$("#vid-container").addClass("thumb")):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},nowPlaying:function(){$(".tab").hide(),gt?($("#vid-container").removeClass("thumb"),$("#vid-container").css("right",0),$("#tab-now-playing").show()):($("#tab-login").show(),$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"))},fullscreen:function(){$("#topbar").hide(),$("#vid-container").removeClass("thumb"),$("#vid-container").addClass("fs")}}),p=window.location.pathname;tt=p.substr(0,p.indexOf("client/")+7),localStorage.username&&(et=localStorage.username,$("#input-username").val(et)),nt=localStorage[V("apiTarget")]||window.location.protocol+"//"+window.location.host+tt.replace("client","api"),$("#input-target").val(nt);var h=new u;h.bind("all",function(){L(),J(),$("#overlay-info").hide()});var g=0,b="100%"===$(".col").css("width"),w=!1;$("#podcast-cols").on("click",".cast",function(){h.navigate("p1",{trigger:!0})}),$("#podcast-cols").on("click",".episode",function(){h.navigate("p2",{trigger:!0})}),$(window).resize(function(){b=window.innerWidth<600,!w&&b?($(".col").hide(),$(".col:eq("+g+")").show(),2===g?($("#podcast-vmenu").hide(),$("#podcast-cols").css("left","0px")):($("#podcast-vmenu").show(),$("#podcast-cols").css("left","50px"))):w&&!b&&($(".col").show(),$("#podcast-vmenu").show(),$("#podcast-cols").css("left","50px")),$(".pretty-button").css("line-height",$("#pretty img").height()+"px"),$("#pretty img").css("max-height",.4*$("#main-container").height()+"px"),w=b}),$("#navicon").click(function(){$("#menu-container").toggle()}),$("a").click(function(e){e.preventDefault();var t=e.target.pathname.substr(tt.length,e.target.pathname.length-tt.length+1);h.navigate(t,{trigger:!0})}),$("#vid").on("timeupdate",function(){var e=W("vid");n(e.currentTime)}),Chromecast.timeUpdate(function(e){n(e),lt=e}),$("#vid").click(function(){O()}),$("#vid").dblclick(function(){z()}),$("#vid-thumb-bar .popout").click(function(){var e=W("vid");c(Lt?Nt.Pause:Nt.Play),e.setAttribute("src","#"),e.load(),at=window.open(tt+"fullscreen","popout","toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=0,top=0"),$(at).on("beforeunload",function(){at=null;var e=xt;xt=null,s(e)}),$(at).on("timeupdate",function(e){n(e.originalEvent.data.time)}),$(at).on("unload",function(){if(localStorage.beforeunloadevent){var e=JSON.parse(localStorage.beforeunloadevent);c(e.type,e.id,e.time),localStorage.removeItem("unloadevent"),localStorage.removeItem("beforeunloadevent")}})}),$("#vid-thumb-bar .minimize").click(function(){$("#vid-container").toggleClass("minimized")}),"popout"===window.name&&$(window).on("message",function(e){var t=JSON.parse(e.originalEvent.data);switch(t.action){case"playPause":O();break;case"skipForward":B();break;case"skipBack":R();break;case"seek":H(t.time);break;case"muteToggle":I();break;case"volume":j(t.volume)}}),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){$("#vid-container").toggleClass("fs"),$("#vid-container").hasClass("fs")?($("#vid-container").removeClass("thumb"),$("#playbar").detach().appendTo("#vid-container"),$("#playbar").show()):("now-playing"!==Backbone.history.fragment&&$("#vid-container").addClass("thumb"),$("#playbar").detach().appendTo("body"),$("#playbar").show(),null!==k&&clearTimeout(k),$("#overlay-info").stop().hide())});var k=null;$("#vid-container").mousemove(function(){E||($(this).hasClass("fs")?($("#playbar").show(),$("#overlay-info").fadeIn("fast"),null!==k&&clearTimeout(k),k=setTimeout(function(){$("#playbar").hide(),$("#overlay-info").stop().fadeOut("fast")},1e3)):"0px"==$(this).css("right")&&($("#overlay-info").fadeIn("fast"),null!==k&&clearTimeout(k),k=setTimeout(function(){$("#overlay-info").stop().fadeOut("fast")},1e3)))});var E=!1;$("#playbar").mouseover(function(){E=!0,$(this).parent().hasClass("fs")&&null!==k&&clearTimeout(k),$("#badeball").css("height","20px").css("width","20px").css("top","-5px").css("margin-left","0px"),$("#seekbar").css("height","10px")}),$("#playbar").mouseout(function(){E=!1,$(this).parent().hasClass("fs")&&(k=setTimeout(function(){$("#playbar").hide(),$("#overlay-info").fadeOut("fast")},1e3)),D||($("#seekbar").css("height","5px"),$("#badeball").css("height","0px").css("width","0px").css("top","2.5px").css("margin-left","10px"))}),$(window).on("beforeunload",function(){null!==xt&&(Lt||Ut||(localStorage.beforeunloadevent=JSON.stringify({type:Nt.Play,id:xt,time:0|W("vid").currentTime})))}),$(window).on("unload",function(){null!==xt&&(Lt||Ut||(localStorage.unloadevent=JSON.stringify({type:Nt.Play,id:xt,time:0|W("vid").currentTime})))}),$(".button-skipback").click(function(){R()}),$(".button-play").click(function(){O()}),$(".button-skipforward").click(function(){B()}),$("#vid").on("loadstart",function(){$("#ep-"+xt+" i").length>0&&$("#ep-"+xt+" i").remove(),$("#vid-container").hide(),U()}),$("#vid").on("canplay",function(){var e=W("vid");e.videoWidth>0?(rt="video",$("#vid-container").removeClass("audio"),$("#vid-container").show()):($("#vid-art").prop("src",K(xt)),rt="audio",$("#vid-container").show(),$("#vid-container").addClass("audio")),J(),ht=e.duration;var t=vt[xt].lastevent;t&&t.type==Nt.EndOfTrack&&(Ut=!0,Lt=!0),null!==t&&Tt&&t.type!=Nt.EndOfTrack&&(e.currentTime=t.positionts,t.type==Nt.Play?N():A()),kt&&Tt&&(kt=!1,t&&t.type==Nt.EndOfTrack||N()),Tt=!1,U()}),$("#vid").on("ended",function(){c(Nt.EndOfTrack),$("#vid-container").hide(),Ut=!0,U(),q()});var D=!1;$("#seekbar").mousedown(function(e){c(Nt.Pause),H(1/$("#seekbar").width()*(e.pageX-$("#seekbar").position().left)*ht),D=!0}),$("#badeball").mousedown(function(e){c(Nt.Pause),H(1/$("#seekbar").width()*(e.pageX-$("#seekbar").position().left)*ht),D=!0}),$("#seekbar").mouseover(function(){}),$("#seekbar").mouseout(function(){D||$("#seektime").hide()}),$("#seekbar").mousemove(function(e){d(e.pageX)}),$(document).mouseup(function(){mt=!1,D&&($("#seektime").hide(),$("#seekbar").css("height","5px"),$("#badeball").css("height","0px").css("width","0px").css("top","5px"),D=!1,c(Nt.Play),W("vid").paused&&c(Nt.Pause)),X&&(X=!1,F||$("#volume .bar").hide())}),$(document).mousemove(function(e){if(mt){var t=$(".thumb"),n=window.innerWidth-e.pageX-wt-(window.innerWidth-(t.offset().left+t.width()));t.css("width",n+"px"),y("ThumbWidth",n,"__client")}D&&(H(1/$("#seekbar").width()*(e.pageX-$("#seekbar").position().left)*ht),d(e.pageX)),X&&j(1/60*(e.pageX-$("#volume .bar .inner").position().left))}),$("#playbar-gear").click(function(){$("#playbar-gear-menu").toggle()}),$("#playbar-fullscreen").click(z),$(".playback-rate").click(function(){var e=$(this).attr("rate");$(".playback-rate").removeClass("selected"),$(this).addClass("selected"),W("vid").playbackRate=e,y("PlaybackRate",e,"Playback")}),$("#button-login").click(a),$("#input-password").keydown(function(e){13===e.which&&a()}),$("#button-logout").click(function(){localStorage.removeItem("token"),$("#vid-container").hide(),$("#playbar").hide(),$("#topbar nav").hide(),$("#userinfo").hide(),$(".tab").hide(),$("#tab-login").show()}),$("#vmenu-add").click(function(){var e=$(".vmenu-toggle:visible");$("#input-vmenu-add").toggle(),$("#button-vmenu-add").toggle(),$("#vmenu-add-results").toggle(),e.hide(),$("#input-vmenu-add").focus(),$("#input-vmenu-add:visible").length>0&&dt.scrollTo(0,0)}),$("#button-vmenu-add").click(function(){e($("#input-vmenu-add").val())}),$("#input-vmenu-add").keydown(function(t){t.stopPropagation();var n=$("#vmenu-add-results p.selected");if(13===t.which)n.length>0?(e(n.attr("feed-url")),n.parent().empty()):e($(this).val());else if(40===t.which){var i=$("#vmenu-add-results p"),s=n.removeClass("selected").index();s++,s>i.length-1&&(s=0),$(i.get(s)).addClass("selected")}else if(38===t.which){var i=$("#vmenu-add-results p"),s=n.removeClass("selected").index();s--,0>s&&(s=i.length-1),$(i.get(s)).addClass("selected")}});var M;$("#input-vmenu-add").keyup(function(e){if(40!==e.which&&38!==e.which){clearTimeout(M);var t=$(this).val();M=setTimeout(function(){$.ajax({url:"http://itunes.apple.com/search",jsonp:"callback",dataType:"jsonp",data:{media:"podcast",term:t,limit:5},success:function(e){$("#vmenu-add-results").empty(),e.results.forEach(function(e){$("#vmenu-add-results").append('<p feed-url="'+e.feedUrl+'">'+e.trackName+"</p>")}),$("#vmenu-add-results p:first-child").addClass("selected")}})},100)}}),$("#vmenu-add-results").on("click","p",function(){e($(this).attr("feed-url")),$(this).parent().empty()}),$("#vmenu-label").click(function(){var e=$(".vmenu-toggle:visible");$("#input-vmenu-label").toggle(),$("#button-vmenu-label").toggle(),e.hide(),$("#input-vmenu-label").focus(),$("#input-vmenu-label:visible").length>0&&dt.scrollTo(0,0)}),$("#button-vmenu-label").click(function(){t($("#input-vmenu-label").val())}),$("#input-vmenu-label").keydown(function(e){13===e.which&&t($(this).val())}),$("#vmenu-sync").click(function(){l(!0)}),L(),$(window).resize(function(){$("#login-container").css("padding-top",(window.innerHeight-60)/2-$("#login-container").height()/2+"px"),L()}),$(document).click(function(){$(".context-menu").hide()}),$("#volume i").click(function(){I()});var F=!1;$("#volume").mouseover(function(){$("#volume .bar").show(),F=!0}),$("#volume").mouseout(function(){X||$("#volume .bar").hide(),F=!1});var X=!1;$("#volume .bar").mousedown(function(e){j(1/60*(e.pageX-$("#volume .bar .inner").position().left)),X=!0}),$("#podcasts").on("contextmenu",".cast",function(e){e.stopPropagation(),G("#cast-context-menu",this,e)}),$("#podcasts").on("contextmenu",".label",function(e){G("#label-context-menu",this,e)}),$("#episodes").on("contextmenu",".episode",function(e){G("#episode-context-menu",this,e)}),$("#podcasts").on("mouseover",".cast",function(){Pt=$(this).id()}),$("#podcasts").on("mouseout",".cast",function(){Pt=null}),$("#episodes").on("mouseover",".episode",function(){Et=$(this).id()}),$("#episodes").on("mouseout",".episode",function(){Et=null});var Y,Q=!1;$(document).keydown(function(e){Q=e.shiftKey,(e.ctrlKey||e.metaKey)&&(clearTimeout(Y),Y=setTimeout(function(){yt=!1},1e3),yt=!0,$(e.target).is("input:visible,textarea:visible")||window.getSelection().toString()||(null!==Pt?$("#clip").val(bt[Pt].url).focus().select():null!==Et&&$("#clip").val(vt[Et].feed.enclosure.url).focus().select()))}),$(document).keyup(function(){yt=!1,Q=!1}),$("#cast-context-show-all").click(function(){m(ct)}),$("#cast-context-rename").click(function(){var e=$("#cast-"+ct+" .name").html();$("#cast-"+ct+" .name").html('<input type="text">'),$(".cast input").focus(),$(".cast input").val(e),$(".cast input").keydown(function(e){if(13===e.which){var t=$(this).val();$(this).parent().html(t),$.ajax(nt+"library/casts/"+ct,{type:"PUT",data:{name:t}})}})}),$("#cast-context-unsub").click(function(){$(".cast.selected").each(function(){var e=$(this).id();$("#cast-"+e).remove(),$.ajax(nt+"library/casts/"+e,{type:"DELETE"})}),$("#cast-"+ct).remove(),$.ajax(nt+"library/casts/"+ct,{type:"DELETE",success:function(){T()}})});var st;$("#cast-context-label").click(function(){$("#add-to-label").show(),st=dt.y,dt.scrollTo(0,0)}),$("#add-to-label").on("click","p",function(){$("#add-to-label").hide();$(this).id();dt.scrollTo(0,st)}),$("#label-context-rename").click(function(){var e=$("#label-"+ct+" .name span").html();$("#label-"+ct+" .name span").html('<input type="text">'),$(".label input").focus(),$(".label input").val(e),$(".label input").keydown(function(e){if(13===e.which){var t=$(this).val();$(this).parent().html(t),$.ajax(nt+"library/labels/"+ct,{type:"PUT",data:{name:t}})}})}),$("#label-context-delete").click(function(){$("#label-"+ct+" .cast").detach().appendTo("#podcasts"),$("#label-"+ct).remove(),setTimeout(function(){dt.refresh()},0),$.ajax(nt+"labels/"+ct,{type:"DELETE"})}),$("#episode-context-play").click(function(){kt=!0,i(ct),s(ct)}),$("#episode-context-reset").click(function(){v(ct)}),$("#episode-context-delete").click(function(){$("#"+ct).hasClass("selected")||o(ct),$(".episode.selected").each(function(){o($(this).id())})}),$("#input-target").keyup(function(){var e=$(this).val();-1===e.indexOf("/",e.length-1)&&(e+="/"),$.ajax(e+"account/ping",{type:"GET",error:function(e){"Bad token"===e.responseText?$("#input-target-container i").show():$("#input-target-container i").hide()},success:function(){$("#input-target-container i").hide()}})}),$("#pretty").click(function(){St!==xt?(kt=!0,s(St)):O()}),$("#pretty img").load(function(){$("#pretty img").css("max-height",.4*$("#main-container").height()+"px"),$(".pretty-button").css("line-height",$(this).height()+"px")}),$("#episode-bar-events").click(function(){$("#events").css("left","66.666666%")}),$("#episode-bar-play").click(function(){St!==xt?(kt=!0,s(St)):O()}),$("#events").on("click","#events-close",function(){$("#events").css("left","100%")}),$("#events").on("click","div",function(){$("#events").css("left","100%");var e=$(this).attr("event-type"),t=W("vid");t.currentTime=$(this).attr("event-position"),Chromecast.seek($(this).attr("event-position")),e==Nt.Start||e==Nt.Play?t.play():t.pause()}),$(".cc").click(function(){Chromecast.running()?($(".cc img").prop("src","img/cast_off.png"),Chromecast.stop(),$("#cast-overlay").hide(),W("vid").currentTime=lt,N()):($(".cc img").prop("src","img/cast_on.png"),Chromecast.start(),Chromecast.load(vt[xt].feed.enclosure.url,{title:vt[xt].feed.title,description:vt[xt].feed.description,image:K(xt)}))}),$("#podcasts").on("click",".label .name",function(){$(this).parent().find(".content").toggle(),$(this).find("i").hasClass("fa-angle-down")?($(this).find("i").removeClass("fa-angle-down"),$(this).find("i").addClass("fa-angle-up")):($(this).find("i").removeClass("fa-angle-up"),$(this).find("i").addClass("fa-angle-down")),setTimeout(function(){dt.refresh()},0),P()}),$("#podcasts").on("click",".cast",function(){if(yt)$(this).toggleClass("selected");else if(Q){if($(this).parent()[0]==$("#cast-"+Ct).parent()[0]){var e=$("#cast-"+Ct).index(),t=$(this).index(),n=$(this).parent().find(".cast");e>t?t--:t++,n.removeClass("selected"),_.range(e,t,e>t?-1:1).forEach(function(e){$(n.get(e)).addClass("selected")})}}else{var i=$(this).id();f(i)}}),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){J()}),$("#episodes").on("click",".episode",function(){if(yt)$(this).toggleClass("selected"),$(this).children(".bar").toggle();else if(Q){var e=$("#ep-"+St).index(),t=$(this).index(),n=$(".episode");e>t?t--:t++,n.removeClass("selected"),_.range(e,t,e>t?-1:1).forEach(function(e){$(n.get(e)).addClass("selected")})}else i($(this).id())}),$("#episodes").on("dblclick",".episode",function(){var e=$(this).id();kt=!0,s(e)}),$("#episodes").on("click",".delete",function(e){e.stopPropagation();var t=$(this).parent().id();o(t)}),$("#episodes").on("click",".reset",function(e){e.stopPropagation();var t=$(this).parent().id();v(t),$(this).hide();var n=$("#cast-"+vt[t].castid+" .n");n.html(parseInt(n.html())+1)}),$("#episodes").on("mouseover",".episode",function(){if($(this).children(".progress").css("color","#FFF"),$(this).find(".fa-circle").length>0){var e=$(this).id(),t=e in vt?vt[e]:$t[e];$(this).children(".delete, .reset").show(),t.lastevent.type==Nt.Delete?$(this).children(".delete").html("Reset").removeClass("delete").addClass("reset"):$(this).children(".reset").html("Delete").removeClass("reset").addClass("delete")}}),$("#episodes").on("mouseout",".episode",function(){$(this).children(".progress").css("color","#666"),$(this).children(".delete, .reset").hide()}),$("#episodes").on("click","#show-all-episodes",function(){m(Ct)}),$("body").on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),$("body").on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.files[0],n=new FileReader;n.onload=function(){$.post(nt+"library/casts.opml",{opml:n.result})},n.readAsText(t)}),$("#settings-panel").on("click","#opml",function(){$.get(nt+"library/casts.opml",function(e){var t=window.document.createElement("a");t.href=window.URL.createObjectURL(new Blob([e],{type:"text/plain"})),t.download="casts.opml",document.body.appendChild(t),t.click(),document.body.removeChild(t)})}),$("#settings-panel").on("click","#import-opml",function(){$("#hax").click()}),$("#settings-panel").on("change","#hax",function(e){var t=e.target.files[0],n=new FileReader;n.onload=function(){$.post(nt+"library/casts.opml",{opml:n.result})},n.readAsText(t)}),$("#settings-panel").on("click","#clear-local-data",function(){it.clear(function(){setTimeout(S,1e3)}),localStorage.clear(),sessionStorage.clear()}),$("#settings-panel").on("click","#reset-settings",x);var ot;$("#tab-settings").on("keyup",".setting",function(){clearTimeout(ot);var e=$(this).prop("id").split("_"),t=$(this).val();ot=setTimeout(function(){y(e[1],t,e[0])},500)}),$("#tab-settings").on("change","checkbox.setting",function(){var e=$(this).prop("id").split("_"),t=$(this).prop("checked");y(e[1],t,e[0])}),$("#tab-settings").on("keydown",".keybind",function(e){e.preventDefault(),e.stopPropagation();var t="";e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.metaKey&&(t+="meta+");var n={8:"backspace",9:"tab",13:"enter",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del"},i=e.which>47&&e.which<58||e.which>64&&e.which<91||e.which>95&&e.which<112||e.which>185&&e.which<193||e.which>218&&e.which<223;if(i){var s=String.fromCharCode(e.which).toLowerCase();t+=s}else if(e.which in n){var s=n[e.which];t+=s}return(i||e.which in n)&&$(this).val(t),!1});var mt=!1,wt=0;$("#vid-thumb-bar .drag").mousedown(function(e){mt=!0,wt=e.pageX-$(".thumb").offset().left}),$("#settings-menu").on("click","p",function(){var e=$(this).id();$(".setting-panel").hide(),$(".setting-button").removeClass("selected"),$("#setting-"+e).addClass("selected"),$("#setting-panel-"+e).show()}),C(),pt=new IScroll("#episodeinfo",{mouseWheel:!0,scrollbars:"custom",keyBindings:!0,interactiveScrollbars:!0,click:!0}),localStorage.token&&(Z=localStorage.token,r(),$("#playbar").show(),$("#topbar nav").show(),$("#userinfo").show()),Backbone.history.start({pushState:!0,root:tt})});var Ht,Rt,Bt=!1,It=0,jt=[],qt=null,Mt=0,zt=!0,Kt=!0,Lt=!1,Ut=!1;Number.prototype.pad=function(){for(var e=this.toString();e.length<2;)e="0"+e;return e},$.fn.isOverflowing=function(){var e=$(this).get(0),t=!1;return e.clientHeight<e.scrollHeight&&(t=!0),t},$.fn.id=function(){return this.prop("id").split("-")[1]}}();